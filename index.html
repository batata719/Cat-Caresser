<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mestre dos Gatos: Ascens√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #201a1e;
            --panel-color: #332b30;
            --accent-color: #ffcc00; /* Amarelo Gato */
            --text-color: #ffffff;
            --btn-bg: #4a3b45;
            --green: #4cd964;
            --red: #ff453a;
            --purple: #bf5af2;
            --gold: #ffd700;
            --karma-color: #00e5ff; /* Ciano para Karma */
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- UI GERAL --- */
        .util-btn {
            background: transparent;
            border: 2px solid #555;
            color: #ccc;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .util-btn:hover { background: rgba(255,255,255,0.1); color: #fff; border-color: #fff; }
        .util-btn.danger { border-color: #883333; color: #cc6666; }
        .util-btn.danger:hover { background: var(--red); border-color: var(--red); color: white; }
        
        /* Bot√£o Ascender (Especial) */
        .util-btn.ascend { border-color: var(--karma-color); color: var(--karma-color); }
        .util-btn.ascend:hover { background: rgba(0, 229, 255, 0.2); box-shadow: 0 0 10px var(--karma-color); }

        /* Bot√£o Pescar (Especial) */
        .util-btn.fish-btn { border-color: var(--gold); color: var(--gold); }
        .util-btn.fish-btn:hover { background: rgba(255, 215, 0, 0.2); box-shadow: 0 0 10px var(--gold); }

        /* --- TELA INICIAL --- */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(32, 26, 30, 0.98);
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        .start-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .start-content { text-align: center; animation: popIn 0.8s; }
        .start-content h1 { font-family: 'Fredoka One'; font-size: 4rem; color: var(--accent-color); }
        .cat-mascot { font-size: 8rem; animation: floatMascot 3s ease-in-out infinite; }
        #start-btn { padding: 15px 50px; font-size: 1.5rem; background: var(--accent-color); border: none; border-radius: 50px; cursor: pointer; font-family: 'Fredoka One'; }

        /* --- PEIXE DOURADO (EVENTO) --- */
        .golden-fish {
            position: absolute;
            font-size: 4rem;
            cursor: pointer;
            z-index: 1500;
            animation: swim 15s linear forwards;
            filter: drop-shadow(0 0 10px gold);
            transition: transform 0.1s;
        }
        .golden-fish:active { transform: scale(0.9); }
        @keyframes swim {
            from { left: -100px; }
            to { left: 110vw; }
        }

        /* --- MODAIS --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 3000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
            transition: opacity 0.3s;
        }
        .modal-overlay.hidden { opacity: 0; pointer-events: none; }
        .modal {
            background: var(--panel-color);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--accent-color);
            max-width: 90%;
            width: 500px;
            position: relative;
        }
        .modal h3 { color: var(--accent-color); font-size: 1.8rem; margin-bottom: 1rem; font-family: 'Fredoka One'; }
        
        /* Modal Ascens√£o */
        .modal.ascend-theme { border-color: var(--karma-color); box-shadow: 0 0 30px rgba(0,229,255,0.3); }
        .modal.ascend-theme h3 { color: var(--karma-color); }

        /* Modal Pesca */
        .fishing-area {
            width: 100%;
            height: 40px;
            background: #222;
            border-radius: 20px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
            border: 2px solid #555;
        }
        .fishing-target {
            width: 60px;
            height: 100%;
            background: rgba(76, 217, 100, 0.5);
            position: absolute;
            left: 50%; /* Din√¢mico */
            transform: translateX(-50%);
            border-left: 2px solid var(--green);
            border-right: 2px solid var(--green);
        }
        .fishing-bar {
            width: 10px;
            height: 100%;
            background: #fff;
            position: absolute;
            left: 0;
            box-shadow: 0 0 10px #fff;
        }

        /* --- JOGO PRINCIPAL --- */
        .game-container { display: flex; width: 100%; height: 100%; }
        
        .bakery-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, #332b30 0%, #1a1518 100%);
            position: relative;
            border-right: 2px solid #111;
        }

        /* --- NOVOS DISPLAYERS DE MOEDA --- */
        .currency-bar {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 15px;
        }
        .currency-item {
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .karma-display { color: var(--karma-color); border: 1px solid var(--karma-color); }
        .sachet-display { color: var(--gold); border: 1px solid var(--gold); }

        /* Efeito de Frenesi (Peixe) */
        .frenzy-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(255,215,0,0.2) 0%, transparent 70%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 100px;
        }
        .frenzy-overlay.active { opacity: 1; }
        .frenzy-text {
            font-family: 'Fredoka One';
            font-size: 3rem;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255,215,0,0.8);
            animation: pulse 1s infinite;
        }

        .stats-header { text-align: center; margin-bottom: 2rem; z-index: 10; }
        #score-display { font-family: 'Fredoka One'; font-size: 3.5rem; color: var(--accent-color); margin: 0; }
        #cps-display { color: #888; }
        
        .clicker-container { position: relative; cursor: pointer; }
        .cat-clicker { font-size: 13rem; filter: drop-shadow(0 0 25px rgba(0,0,0,0.6)); transition: transform 0.05s; }
        .cat-clicker:active { transform: scale(0.90) rotate(-5deg); }

        .controls { margin-top: 2rem; display: flex; gap: 10px; }
        
        /* Painel Inferior Esquerdo */
        .bottom-left-panel {
            position: absolute;
            bottom: 15px; left: 15px;
            display: flex; gap: 8px; z-index: 100;
        }
        .bottom-left-panel .util-btn { font-size: 0.8rem; padding: 8px 12px; opacity: 0.7; background: rgba(0,0,0,0.4); border: 1px solid #444; }
        .bottom-left-panel .util-btn:hover { opacity: 1; border-color: #888; }

        /* --- LOJA --- */
        .store-section { width: 400px; background: var(--panel-color); display: flex; flex-direction: column; padding: 1rem; box-shadow: -5px 0 15px rgba(0,0,0,0.5); }
        
        .store-section h2 {
            text-align: center;
            margin-bottom: 1rem;
            border-bottom: 1px solid #555;
            padding-bottom: 0.5rem;
            color: var(--accent-color);
            font-family: 'Fredoka One', cursive;
        }

        /* --- CONTROLES DE COMPRA/VENDA --- */
        .mode-controls { display: flex; justify-content: space-between; margin-bottom: 5px; padding: 0 5px; }
        .mode-btn { background: none; border: none; color: #777; font-weight: bold; font-size: 0.9rem; cursor: pointer; text-transform: uppercase; padding-bottom: 2px; font-family: 'Fredoka One', cursive; transition: 0.2s; }
        .mode-btn:hover { color: #aaa; }
        .mode-btn.active { color: #fff; border-bottom: 2px solid #fff; }
        .mode-btn.sell-active { color: var(--red); border-bottom: 2px solid var(--red); }

        .store-tabs { display: flex; gap: 5px; margin-bottom: 10px; background: #222; padding: 3px; border-radius: 8px; }
        .tab-btn { flex: 1; padding: 8px; border: none; background: transparent; color: #888; cursor: pointer; font-weight: bold; border-radius: 5px; }
        .tab-btn.active { background: var(--btn-bg); color: var(--accent-color); }
        .tab-btn.special-tab { color: var(--gold); }
        .tab-btn.special-tab.active { background: #3c3518; color: var(--gold); border: 1px solid var(--gold); }

        #store-container { flex: 1; overflow-y: auto; }
        
        .upgrade-item { background: var(--btn-bg); margin-bottom: 10px; padding: 15px; border-radius: 8px; display: flex; align-items: center; cursor: pointer; transition: all 0.2s; border: 1px solid transparent; }
        .upgrade-item:hover { background: #5c4a56; border-color: rgba(255, 204, 0, 0.3); }
        .upgrade-item.disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(0.8); }
        .upgrade-item.sell-mode { border-color: rgba(255, 69, 58, 0.3); }
        .upgrade-item.sell-mode:hover { background-color: #452b2b; border-color: var(--red); }
        
        /* Custo especial */
        .upgrade-cost.sachet { color: var(--gold); }
        .upgrade-cost.refund { color: var(--green); }
        
        .buy-controls { display: flex; justify-content: center; gap: 5px; margin-bottom: 10px; padding: 5px; background: rgba(0,0,0,0.2); border-radius: 8px; }
        .buy-multiplier { background: transparent; border: 1px solid #555; color: #888; padding: 2px 10px; cursor: pointer; border-radius: 4px; }
        .buy-multiplier.active { background: var(--btn-bg); border-color: var(--accent-color); color: var(--accent-color); }
        
        /* Toast Notification */
        .achievement-toast {
            position: fixed; top: 20px; right: -350px; background: var(--panel-color); border: 2px solid var(--accent-color);
            padding: 15px; border-radius: 10px; display: flex; gap: 15px; z-index: 4000; transition: right 0.5s; width: 300px;
        }
        .achievement-toast.show { right: 20px; }
        
        /* Floating Number */
        .floating-number { position: absolute; color: var(--accent-color); font-weight: bold; font-size: 1.8rem; pointer-events: none; animation: floatUp 1s forwards; text-shadow: 2px 2px 0 #000; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        @keyframes popIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

        /* Lista scroll√°vel */
        .scrollable-list { text-align: left; margin-bottom: 20px; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 8px; max-height: 250px; overflow-y: auto; }
        .scrollable-list::-webkit-scrollbar { width: 6px; }
        .scrollable-list::-webkit-scrollbar-thumb { background: #555; }
    </style>
</head>
<body>

    <!-- NOTIFICA√á√ÉO -->
    <div id="achievement-toast" class="achievement-toast">
        <div style="font-size: 2.5rem;">üèÜ</div>
        <div>
            <h4 style="color:var(--accent-color); margin-bottom:5px;">Conquista!</h4>
            <p id="toast-text" style="color:#ccc; font-size:0.9rem;">Nome</p>
        </div>
    </div>

    <!-- TELA INICIAL -->
    <div id="start-screen" class="start-screen">
        <div class="start-content">
            <h1>Mestre dos Gatos üêæ</h1>
            <p>Ascenda, Pesque e Domine!</p>
            <div class="cat-mascot">üê±</div>
            <br>
            <button id="start-btn">COME√áAR A JOGAR</button>
        </div>
    </div>

    <!-- MODAL ASCENS√ÉO (PREST√çGIO) -->
    <div id="ascend-modal" class="modal-overlay hidden">
        <div class="modal ascend-theme">
            <h3>Ascens√£o Felina üåÄ</h3>
            <p>Resete seu progresso (Pr√©dios, Mimos e Ronrons) para ganhar Karma.</p>
            <p>Cada ponto de Karma aumenta sua produ√ß√£o em <strong>+10%</strong> permanentemente.</p>
            <div style="background: rgba(0,229,255,0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                <p>Karma Atual: <span id="current-karma-display" style="color: var(--karma-color); font-weight: bold;">0</span></p>
                <p>Ao Ascender voc√™ ganha: <span id="pending-karma-display" style="color: #fff; font-weight: bold; font-size: 1.5rem;">+0</span> üåÄ</p>
            </div>
            <div class="modal-buttons">
                <button id="confirm-ascend-btn" class="util-btn ascend">ASCENDER AGORA</button>
                <button id="cancel-ascend-btn" class="util-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- MODAL PESCARIA -->
    <div id="fishing-modal" class="modal-overlay hidden">
        <div class="modal">
            <h3 style="color: var(--gold);">Pescaria da Sorte üé£</h3>
            <p>Clique em "PESCAR!" quando a barra branca estiver na √°rea verde.</p>
            
            <div class="fishing-area">
                <div id="fishing-target" class="fishing-target"></div>
                <div id="fishing-bar" class="fishing-bar"></div>
            </div>
            
            <p id="fishing-status" style="height: 20px; color: #aaa;">Aguardando...</p>

            <div class="modal-buttons">
                <button id="action-fish-btn" class="util-btn fish-btn" style="font-size: 1.2rem; padding: 10px 40px;">PESCAR!</button>
                <button id="close-fish-btn" class="util-btn">Sair</button>
            </div>
        </div>
    </div>

    <!-- MODAL STATS -->
    <div id="stats-modal" class="modal-overlay hidden">
        <div class="modal">
            <h3>Estat√≠sticas üìä</h3>
            <div id="stats-content" class="scrollable-list"></div>
            <button id="close-stats-btn" class="util-btn">Fechar</button>
        </div>
    </div>

    <!-- MODAL CONQUISTAS -->
    <div id="achievements-modal" class="modal-overlay hidden">
        <div class="modal">
            <h3>Conquistas üèÜ</h3>
            <div id="achievements-content" class="scrollable-list"></div>
            <button id="close-achievements-btn" class="util-btn">Fechar</button>
        </div>
    </div>
    
    <!-- MODAL RESET GERAL -->
    <div id="reset-modal" class="modal-overlay hidden">
        <div class="modal">
            <h3 style="color: var(--red);">Reset Completo</h3>
            <p>Isso apaga TUDO, inclusive Karma e Conquistas. Tem certeza?</p>
            <div class="modal-buttons">
                <button id="confirm-reset" class="util-btn danger">Apagar Tudo</button>
                <button id="cancel-reset" class="util-btn">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- JOGO PRINCIPAL -->
    <div class="game-container">
        
        <!-- √Årea de Frenesi -->
        <div id="frenzy-overlay" class="frenzy-overlay">
            <div class="frenzy-text">FRENESI DE OURO! (7x)</div>
        </div>

        <section class="bakery-section">
            
            <!-- Mostradores Especiais -->
            <div class="currency-bar">
                <div class="currency-item karma-display" title="Karma: +10% de B√¥nus por ponto">
                    <span>üåÄ</span> <span id="hud-karma">0</span>
                </div>
                <div class="currency-item sachet-display" title="Sach√™s de Ouro: Moeda Rara">
                    <span>üéí</span> <span id="hud-sachets">0</span>
                </div>
            </div>

            <div class="stats-header">
                <h1 id="score-display">0 Ronrons</h1>
                <p id="cps-display">por segundo: 0.0</p>
                <p id="click-power-display">poder de carinho: 1</p>
            </div>

            <div class="clicker-container">
                <div id="big-cat" class="cat-clicker">üê±</div>
            </div>
            
            <div class="controls">
                <button id="save-btn" class="util-btn">üíæ Salvar</button>
                <button id="ascend-btn" class="util-btn ascend">üåÄ Ascender</button>
                <button id="fish-btn" class="util-btn fish-btn">üé£ Pescar</button>
            </div>
            <div id="message-log">Fa√ßa carinho no gato!</div>

            <!-- Painel Inferior -->
            <div class="bottom-left-panel">
                <button id="stats-btn" class="util-btn">üìä Stats</button>
                <button id="achievements-btn" class="util-btn">üèÜ Conquistas</button>
                <button id="reset-btn" class="util-btn danger">üóëÔ∏è Hard Reset</button>
            </div>
        </section>

        <!-- LOJA -->
        <section class="store-section">
            <h2>Pet Shop</h2>

            <div class="mode-controls">
                <button id="btn-mode-buy" class="mode-btn active" onclick="setSellMode(false)">Comprar</button>
                <button id="btn-mode-sell" class="mode-btn" onclick="setSellMode(true)">Vender</button>
            </div>

            <div class="buy-controls">
                <button class="buy-multiplier active" onclick="setBuyMultiplier(1)">1x</button>
                <button class="buy-multiplier" onclick="setBuyMultiplier(5)">5x</button>
                <button class="buy-multiplier" onclick="setBuyMultiplier(10)">10x</button>
                <button class="buy-multiplier" onclick="setBuyMultiplier('MAX')">M√°x</button>
            </div>

            <div class="store-tabs">
                <button id="tab-buildings" class="tab-btn active">Pr√©dios</button>
                <button id="tab-upgrades" class="tab-btn">Mimos</button>
                <button id="tab-boosts" class="tab-btn">Acess√≥rios</button>
                <button id="tab-specials" class="tab-btn special-tab">Especiais</button>
            </div>
            <div id="store-container"></div>
        </section>
    </div>

    <script>
        const gameState = {
            score: 0,
            totalScoreAccumulated: 0,
            cps: 0,
            clickValue: 1,
            activeTab: 'buildings',
            buyMultiplier: 1,
            sellMode: false,
            clickHistory: [], 
            lastSaveTime: Date.now(),
            
            // Stats
            startTime: Date.now(),
            totalClicks: 0,
            
            // Novos Recursos
            karma: 0,
            goldenSachets: 0,
            prestigeCount: 0,
            
            // Vari√°veis Tempor√°rias (n√£o salvas)
            bonusMultiplier: 1, 
            
            buildings: [
                { id: 0, name: "Petisco", baseCost: 15, cps: 0.1, count: 0, icon: "üêü" },
                { id: 1, name: "Caixa de Papel√£o", baseCost: 100, cps: 1, count: 0, icon: "üì¶" },
                { id: 2, name: "Arranhador", baseCost: 1100, cps: 8, count: 0, icon: "üß∂" },
                { id: 3, name: "Catnip", baseCost: 12000, cps: 47, count: 0, icon: "üåø" },
                { id: 4, name: "F√°brica de Sach√™", baseCost: 130000, cps: 260, count: 0, icon: "üè≠" },
                { id: 5, name: "Santu√°rio Felino", baseCost: 1400000, cps: 1400, count: 0, icon: "‚õ©Ô∏è" },
                { id: 6, name: "Planeta dos Gatos", baseCost: 20000000, cps: 7800, count: 0, icon: "ü™ê" },
                { id: 7, name: "Dimens√£o Gat√°stica", baseCost: 500000000000, cps: 500000, count: 0, icon: "üåå" },
                { id: 8, name: "Deus Gato", baseCost: 100000000000000, cps: 10000000, count: 0, icon: "üî±" }
            ],
            clickItems: [
                { id: 100, name: "Unha Posti√ßa", baseCost: 500, clickIncrease: 1, count: 0, icon: "üíÖ" },
                { id: 101, name: "Laser Pointer", baseCost: 2500, clickIncrease: 5, count: 0, icon: "üî¶" },
                { id: 102, name: "Luva de Escovar", baseCost: 10000, clickIncrease: 15, count: 0, icon: "üß§" },
                { id: 103, name: "Varinha M√°gica", baseCost: 50000, clickIncrease: 50, count: 0, icon: "ü™Ñ" },
                { id: 104, name: "M√£o Rob√≥tica", baseCost: 200000, clickIncrease: 200, count: 0, icon: "ü§ñ" },
                { id: 105, name: "Manopla do Infinito", baseCost: 50000000, clickIncrease: 5000, count: 0, icon: "üíé" },
                { id: 106, name: "Dedo de Midas", baseCost: 1000000000, clickIncrease: 25000, count: 0, icon: "üëë" }
            ],
            // LISTA COMPLETA REINTEGRADA E ORDENADA POR PRE√áO
            boosts: [
                { id: 200, name: "Salm√£o Fresco", baseCost: 1000, targetId: 0, targetType: 'building', multiplier: 2, count: 0, icon: "üç£", desc: "Petiscos geram 2x mais" },
                { id: 300, name: "Esmalte Brilhante", baseCost: 2500, targetId: 100, targetType: 'click', multiplier: 2, count: 0, icon: "üíÖ‚ú®", desc: "Unhas d√£o 2x mais" },
                { id: 201, name: "Papel√£o Refor√ßado", baseCost: 5000, targetId: 1, targetType: 'building', multiplier: 2, count: 0, icon: "üì¶", desc: "Caixas geram 2x mais" },
                { id: 202, name: "Sisal Premium", baseCost: 11000, targetId: 2, targetType: 'building', multiplier: 2, count: 0, icon: "üßµ", desc: "Arranhadores geram 2x mais" },
                { id: 301, name: "Pilhas Alcalinas", baseCost: 12000, targetId: 101, targetType: 'click', multiplier: 2, count: 0, icon: "üîã", desc: "Lasers d√£o 2x mais" },
                { id: 210, name: "Tempero Gourmet", baseCost: 50000, targetId: 0, targetType: 'building', multiplier: 2, count: 0, icon: "üßÇ", desc: "Petiscos geram +2x" },
                { id: 302, name: "Escova de A√ßo", baseCost: 50000, targetId: 102, targetType: 'click', multiplier: 2, count: 0, icon: "üöø", desc: "Luvas d√£o 2x mais" },
                { id: 310, name: "Manicure de Ouro", baseCost: 100000, targetId: 100, targetType: 'click', multiplier: 2, count: 0, icon: "‚öúÔ∏è", desc: "Unhas d√£o +2x" },
                { id: 203, name: "Adubo Org√¢nico", baseCost: 120000, targetId: 3, targetType: 'building', multiplier: 2, count: 0, icon: "üå±", desc: "Catnip gera 2x mais" },
                { id: 211, name: "Condom√≠nio Felino", baseCost: 200000, targetId: 1, targetType: 'building', multiplier: 2, count: 0, icon: "üèòÔ∏è", desc: "Caixas geram +2x" },
                { id: 303, name: "P√≥ M√°gico", baseCost: 250000, targetId: 103, targetType: 'click', multiplier: 2, count: 0, icon: "‚ú®", desc: "Varinhas d√£o 2x mais" },
                { id: 311, name: "Laser de Discoteca", baseCost: 500000, targetId: 101, targetType: 'click', multiplier: 2, count: 0, icon: "üï∫", desc: "Lasers d√£o +2x" },
                { id: 212, name: "Torre de Sisal", baseCost: 1000000, targetId: 2, targetType: 'building', multiplier: 2, count: 0, icon: "üóº", desc: "Arranhadores geram +2x" },
                { id: 304, name: "Chip de IA", baseCost: 1000000, targetId: 104, targetType: 'click', multiplier: 2, count: 0, icon: "üíæ", desc: "M√£os Rob√≥ticas d√£o 2x mais" },
                { id: 204, name: "Automa√ß√£o", baseCost: 1300000, targetId: 4, targetType: 'building', multiplier: 2, count: 0, icon: "‚öôÔ∏è", desc: "F√°bricas geram 2x mais" },
                { id: 312, name: "Luva de Seda", baseCost: 2000000, targetId: 102, targetType: 'click', multiplier: 2, count: 0, icon: "üß£", desc: "Luvas d√£o +2x" },
                { id: 213, name: "Estufa Hidrop√¥nica", baseCost: 5000000, targetId: 3, targetType: 'building', multiplier: 2, count: 0, icon: "üß™", desc: "Catnip gera +2x" },
                { id: 313, name: "Varinha Real", baseCost: 10000000, targetId: 103, targetType: 'click', multiplier: 2, count: 0, icon: "ü§¥", desc: "Varinhas d√£o +2x" },
                { id: 205, name: "√çdolo Dourado", baseCost: 14000000, targetId: 5, targetType: 'building', multiplier: 2, count: 0, icon: "üóø", desc: "Santu√°rios geram 2x mais" },
                { id: 214, name: "Rob√¥s Felinos", baseCost: 50000000, targetId: 4, targetType: 'building', multiplier: 2, count: 0, icon: "ü¶æ", desc: "F√°bricas geram +2x" },
                { id: 314, name: "Nanotecnologia", baseCost: 100000000, targetId: 104, targetType: 'click', multiplier: 2, count: 0, icon: "üß¨", desc: "M√£os Rob√≥ticas d√£o +2x" },
                { id: 206, name: "Bandeira da Paz", baseCost: 200000000, targetId: 6, targetType: 'building', multiplier: 2, count: 0, icon: "üè≥Ô∏è", desc: "Planetas geram 2x mais" },
                { id: 215, name: "Peregrina√ß√£o Global", baseCost: 500000000, targetId: 5, targetType: 'building', multiplier: 2, count: 0, icon: "üïã", desc: "Santu√°rios geram +2x" },
                { id: 216, name: "Gal√°xia de Leite", baseCost: 5000000000, targetId: 6, targetType: 'building', multiplier: 2, count: 0, icon: "ü•õ", desc: "Planetas geram +2x" },
                { id: 220, name: "Dobra Espacial", baseCost: 5000000000000, targetId: 7, targetType: 'building', multiplier: 2, count: 0, icon: "üåÄ", desc: "Dimens√µes geram 2x mais" },
                { id: 221, name: "Oferenda C√≥smica", baseCost: 1000000000000000, targetId: 8, targetType: 'building', multiplier: 2, count: 0, icon: "ü™ê", desc: "Deuses geram 2x mais" }
            ],
            specials: [
                { id: 900, name: "Aura Dourada", costSachets: 1, multiplier: 1.5, count: 0, icon: "üåü", desc: "Multiplica TODO o CPS por 1.5x (Global)" },
                { id: 901, name: "Pescador Mestre", costSachets: 3, multiplier: 1, count: 0, icon: "üé£", desc: "Melhora a chance na pesca (Passivo)" },
                { id: 902, name: "Reencarna√ß√£o Veloz", costSachets: 5, multiplier: 2, count: 0, icon: "‚è©", desc: "Ganha 2x mais Karma ao ascender" }
            ],
            // LISTA DE CONQUISTAS REINTEGRADA
            achievements: [
                { id: 'click1', name: "Primeiro Carinho", desc: "Clique no gato 1 vez.", icon: "üëÜ", unlocked: false, check: (s) => s.totalClicks >= 1 },
                { id: 'click100', name: "Amante de Gatos", desc: "100 Cliques", icon: "üòª", unlocked: false, check: (s) => s.totalClicks >= 100 },
                { id: 'click1000', name: "Dedo Furioso", desc: "Clique no gato 1.000 vezes.", icon: "‚ö°", unlocked: false, check: (s) => s.totalClicks >= 1000 },
                { id: 'score1000', name: "Ronronando", desc: "Acumule 1.000 Ronrons no total.", icon: "üß∂", unlocked: false, check: (s) => s.totalScoreAccumulated >= 1000 },
                { id: 'score1m', name: "Milion√°rio", desc: "1 Milh√£o de Ronrons", icon: "üí∞", unlocked: false, check: (s) => s.totalScoreAccumulated >= 1000000 },
                { id: 'score1b', name: "Bilion√°rio", desc: "1 Bilh√£o de Ronrons", icon: "üè¶", unlocked: false, check: (s) => s.totalScoreAccumulated >= 1000000000 },
                { id: 'cps100', name: "Linha de Produ√ß√£o", desc: "Alcance 100 Ronrons por segundo.", icon: "üè≠", unlocked: false, check: (s) => s.cps >= 100 },
                { id: 'build10', name: "Imobili√°ria", desc: "Tenha 10 constru√ß√µes no total.", icon: "üèóÔ∏è", unlocked: false, check: (s) => s.buildings.reduce((a,b)=>a+b.count,0) >= 10 },
                { id: 'build50', name: "Imp√©rio", desc: "Tenha 50 constru√ß√µes no total.", icon: "üè∞", unlocked: false, check: (s) => s.buildings.reduce((a,b)=>a+b.count,0) >= 50 },
                { id: 'karma1', name: "Iluminado", desc: "Consiga 1 ponto de Karma", icon: "üåÄ", unlocked: false, check: (s) => s.karma >= 1 },
                { id: 'sachet1', name: "Tesouro", desc: "Pesque 1 Sach√™ de Ouro", icon: "üéí", unlocked: false, check: (s) => s.goldenSachets >= 1 }
            ]
        };

        const elements = {
            // Displays
            scoreDisplay: document.getElementById('score-display'),
            cpsDisplay: document.getElementById('cps-display'),
            clickPowerDisplay: document.getElementById('click-power-display'),
            hudKarma: document.getElementById('hud-karma'),
            hudSachets: document.getElementById('hud-sachets'),
            
            // Game Objects
            bigCat: document.getElementById('big-cat'),
            storeContainer: document.getElementById('store-container'),
            frenzyOverlay: document.getElementById('frenzy-overlay'),
            
            // Buttons
            ascendBtn: document.getElementById('ascend-btn'),
            fishBtn: document.getElementById('fish-btn'),
            statsBtn: document.getElementById('stats-btn'),
            achievementsBtn: document.getElementById('achievements-btn'),
            resetBtn: document.getElementById('reset-btn'),
            saveBtn: document.getElementById('save-btn'),
            
            // Modals
            ascendModal: document.getElementById('ascend-modal'),
            fishingModal: document.getElementById('fishing-modal'),
            statsModal: document.getElementById('stats-modal'),
            achievementsModal: document.getElementById('achievements-modal'),
            resetModal: document.getElementById('reset-modal'),
            
            // Modal Elements
            currentKarmaDisplay: document.getElementById('current-karma-display'),
            pendingKarmaDisplay: document.getElementById('pending-karma-display'),
            confirmAscendBtn: document.getElementById('confirm-ascend-btn'),
            cancelAscendBtn: document.getElementById('cancel-ascend-btn'),
            
            fishingBar: document.getElementById('fishing-bar'),
            fishingTarget: document.getElementById('fishing-target'),
            fishingStatus: document.getElementById('fishing-status'),
            actionFishBtn: document.getElementById('action-fish-btn'),
            closeFishBtn: document.getElementById('close-fish-btn'),
            
            closeStatsBtn: document.getElementById('close-stats-btn'),
            closeAchievementsBtn: document.getElementById('close-achievements-btn'),
            confirmResetBtn: document.getElementById('confirm-reset'),
            cancelResetBtn: document.getElementById('cancel-reset'),
            
            // Listas
            statsContent: document.getElementById('stats-content'),
            achievementsContent: document.getElementById('achievements-content'),
            
            // Tabs
            tabBuildings: document.getElementById('tab-buildings'),
            tabUpgrades: document.getElementById('tab-upgrades'),
            tabBoosts: document.getElementById('tab-boosts'),
            tabSpecials: document.getElementById('tab-specials'),
            
            multiplierBtns: document.querySelectorAll('.buy-multiplier'),
            btnModeBuy: document.getElementById('btn-mode-buy'),
            btnModeSell: document.getElementById('btn-mode-sell'),
            startScreen: document.getElementById('start-screen'),
            startBtn: document.getElementById('start-btn'),
            msgLog: document.getElementById('message-log') 
        };

        // --- Vari√°veis de Sistema ---
        let fishingInterval = null;
        let fishingPosition = 0;
        let fishingDirection = 1;
        let fishingSpeed = 2;
        let fishBonusTimeout = null;
        let lastFishSpawn = Date.now();

        function init() {
            loadGame();
            updateTabVisuals();
            renderStore();
            
            setInterval(gameLoop, 100); 
            setInterval(checkAchievements, 1000); 
            setInterval(trySpawnGoldenFish, 1000); // Tenta spawnar peixe

            // Auto-Save
            setInterval(() => { saveGame(); showMessage("Salvo! üíæ"); }, 30000); 

            // Event Listeners
            elements.bigCat.addEventListener('click', handleCatClick);
            elements.saveBtn.addEventListener('click', () => { saveGame(); showMessage("Salvo!"); });
            elements.startBtn.addEventListener('click', startGame);

            // Modais UI
            setupModalTriggers();
            
            // Store Tabs
            elements.tabBuildings.addEventListener('click', () => switchTab('buildings'));
            elements.tabUpgrades.addEventListener('click', () => switchTab('upgrades'));
            elements.tabBoosts.addEventListener('click', () => switchTab('boosts'));
            elements.tabSpecials.addEventListener('click', () => switchTab('specials'));
        }

        function startGame() {
            elements.startScreen.classList.add('hidden');
        }

        function setupModalTriggers() {
            // Ascend
            elements.ascendBtn.addEventListener('click', openAscendModal);
            elements.confirmAscendBtn.addEventListener('click', performAscend);
            elements.cancelAscendBtn.addEventListener('click', () => elements.ascendModal.classList.add('hidden'));

            // Fishing
            elements.fishBtn.addEventListener('click', openFishingModal);
            elements.actionFishBtn.addEventListener('click', catchFish);
            elements.closeFishBtn.addEventListener('click', closeFishingModal);

            // Stats & Achievements
            elements.statsBtn.addEventListener('click', showStatsModal);
            elements.closeStatsBtn.addEventListener('click', () => elements.statsModal.classList.add('hidden'));
            elements.achievementsBtn.addEventListener('click', showAchievementsModal);
            elements.closeAchievementsBtn.addEventListener('click', () => elements.achievementsModal.classList.add('hidden'));

            // Reset
            elements.resetBtn.addEventListener('click', () => elements.resetModal.classList.remove('hidden'));
            elements.confirmResetBtn.addEventListener('click', performHardReset);
            elements.cancelResetBtn.addEventListener('click', () => elements.resetModal.classList.add('hidden'));
        }

        // --- L√ìGICA DO JOGO ---

        function gameLoop() {
            if (gameState.cps > 0) {
                // Aplica multiplicador de b√¥nus (peixe) e karma
                let earnings = (gameState.cps * getGlobalMultiplier()) / 10;
                addScore(earnings);
            }
            updateUI();
        }

        function getGlobalMultiplier() {
            // Base + Karma (10% por ponto) + Bonus (Peixe) + Especiais
            let karmaMulti = 1 + (gameState.karma * 0.1);
            let specialMulti = 1;
            
            // Aura Dourada
            if(gameState.specials[0].count > 0) specialMulti *= (1.5 ** gameState.specials[0].count);

            return karmaMulti * gameState.bonusMultiplier * specialMulti;
        }

        function addScore(amount) {
            gameState.score += amount;
            gameState.totalScoreAccumulated += amount;
        }

        function handleCatClick(e) {
            let clickVal = gameState.clickValue * getGlobalMultiplier();
            addScore(clickVal);
            
            gameState.totalClicks++;
            createParticles(e.clientX, e.clientY, `+${formatNumber(clickVal)}`);
        }

        function updateUI() {
            let globalMulti = getGlobalMultiplier();
            
            elements.scoreDisplay.textContent = `${formatNumber(Math.floor(gameState.score))} Ronrons`;
            elements.cpsDisplay.textContent = `por segundo: ${formatNumber((gameState.cps * globalMulti).toFixed(1))}`;
            elements.clickPowerDisplay.textContent = `poder de carinho: ${formatNumber((gameState.clickValue * globalMulti).toFixed(1))}`;
            
            elements.hudKarma.textContent = formatNumber(gameState.karma);
            elements.hudSachets.textContent = gameState.goldenSachets;

            // Update Store UI states
            updateStoreButtons();
        }

        // --- L√ìGICA DE PRE√áOS EM MASSA ---

        function getBulkCost(item, multiplier) {
            // Se for special, n√£o usa multiplicador
            if (gameState.activeTab === 'specials') return { totalCost: item.costSachets, count: 1 };

            let totalCost = 0;
            let count = 0;
            let tempScore = gameState.score;
            let tempCount = item.count;

            if (multiplier === 'MAX') {
                // Calcula quantos d√° pra comprar
                while (true) {
                    let nextPrice = Math.floor(item.baseCost * Math.pow(1.15, tempCount));
                    if (tempScore >= nextPrice && count < 1000) { // Limit 1000 to prevent freeze
                        totalCost += nextPrice;
                        tempScore -= nextPrice;
                        tempCount++;
                        count++;
                    } else {
                        break;
                    }
                }
                // Se n√£o der pra comprar nenhum, mostra o custo do pr√≥ximo
                if (count === 0) {
                    totalCost = Math.floor(item.baseCost * Math.pow(1.15, item.count));
                }
            } else {
                count = multiplier;
                for (let i = 0; i < count; i++) {
                    totalCost += Math.floor(item.baseCost * Math.pow(1.15, tempCount + i));
                }
            }
            return { totalCost, count };
        }

        function getBulkRefund(item, multiplier) {
            let refundAmount = 0;
            let count = 0;
            
            // Quantos vender? Se MAX, vende tudo. Se n√£o, vende X ou o que tiver.
            let itemsToSell = (multiplier === 'MAX') ? item.count : Math.min(item.count, multiplier);
            count = itemsToSell;

            let tempCount = item.count; 
            
            for (let i = 0; i < itemsToSell; i++) {
                // Pre√ßo que foi pago pelo item "tempCount - 1"
                let originalCost = Math.floor(item.baseCost * Math.pow(1.15, tempCount - 1));
                refundAmount += Math.floor(originalCost * 0.5);
                tempCount--;
            }

            return { refundAmount, count };
        }

        // --- SISTEMA DE ASCENS√ÉO (KARMA) ---

        function openAscendModal() {
            let potentialKarma = Math.floor(gameState.score / 1000000);
            if(gameState.specials[2].count > 0) potentialKarma *= (2 * gameState.specials[2].count);

            elements.currentKarmaDisplay.textContent = formatNumber(gameState.karma);
            elements.pendingKarmaDisplay.textContent = `+${formatNumber(potentialKarma)}`;
            elements.pendingKarmaDisplay.dataset.value = potentialKarma; // Guarda valor
            
            elements.ascendModal.classList.remove('hidden');
        }

        function performAscend() {
            let karmaToGain = parseInt(elements.pendingKarmaDisplay.dataset.value);
            
            if (karmaToGain <= 0) {
                showMessage("Precisa de 1M Ronrons para ganhar Karma!");
                return;
            }

            // Preserva Itens Permanentes
            let savedKarma = gameState.karma + karmaToGain;
            let savedSachets = gameState.goldenSachets;
            let savedSpecials = JSON.parse(JSON.stringify(gameState.specials));
            let savedAchievements = JSON.parse(JSON.stringify(gameState.achievements));
            let savedStats = {
                startTime: gameState.startTime,
                totalClicks: gameState.totalClicks,
                prestigeCount: gameState.prestigeCount + 1,
                totalScoreAccumulated: gameState.totalScoreAccumulated
            };

            localStorage.removeItem('catClickerSave');
            resetGameStateToDefaults();
            
            gameState.karma = savedKarma;
            gameState.goldenSachets = savedSachets;
            gameState.specials = savedSpecials;
            
            savedAchievements.forEach(savedAch => {
                 if(savedAch.unlocked) {
                     const originalAch = gameState.achievements.find(a => a.id === savedAch.id);
                     if(originalAch) originalAch.unlocked = true;
                 }
            });

            Object.assign(gameState, savedStats);

            saveGame();
            
            if(gameState.karma > 50) elements.bigCat.textContent = "üòº"; 
            if(gameState.karma > 500) elements.bigCat.textContent = "üëæ"; 
            
            elements.ascendModal.classList.add('hidden');
            init(); 
            showMessage("Ascens√£o Completa! üåÄ");
        }

        // --- SISTEMA DE PESCA (SACH√äS) ---

        function openFishingModal() {
            elements.fishingModal.classList.remove('hidden');
            startFishingGame();
        }

        function closeFishingModal() {
            elements.fishingModal.classList.add('hidden');
            clearInterval(fishingInterval);
        }

        function startFishingGame() {
            fishingPosition = 0;
            fishingDirection = 1;
            elements.fishingStatus.textContent = "Concentre-se...";
            elements.fishingStatus.style.color = "#aaa";
            elements.actionFishBtn.disabled = false;
            
            let targetWidth = 30 + Math.random() * 50; 
            let targetLeft = Math.random() * (100 - (targetWidth/3)); 
            
            elements.fishingTarget.style.width = targetWidth + "px";
            elements.fishingTarget.style.left = targetLeft + "%";

            if (fishingInterval) clearInterval(fishingInterval);
            
            fishingInterval = setInterval(() => {
                fishingPosition += fishingSpeed * fishingDirection;
                if (fishingPosition >= 100 || fishingPosition <= 0) fishingDirection *= -1;
                elements.fishingBar.style.left = fishingPosition + "%";
            }, 20);
        }

        function catchFish() {
            clearInterval(fishingInterval);
            elements.actionFishBtn.disabled = true;
            
            let barRect = elements.fishingBar.getBoundingClientRect();
            let targetRect = elements.fishingTarget.getBoundingClientRect();

            let barCenter = barRect.left + (barRect.width / 2);
            
            if (barCenter >= targetRect.left && barCenter <= targetRect.right) {
                elements.fishingStatus.textContent = "PESCOU! üé£ +1 Sach√™ de Ouro!";
                elements.fishingStatus.style.color = "var(--green)";
                gameState.goldenSachets++;
                checkAchievements();
            } else {
                elements.fishingStatus.textContent = "Escapou... Tente de novo!";
                elements.fishingStatus.style.color = "var(--red)";
            }
            
            setTimeout(() => {
                if(!elements.fishingModal.classList.contains('hidden')) startFishingGame();
            }, 1500);
        }

        // --- PEIXE DOURADO (EVENTO) ---

        function trySpawnGoldenFish() {
            if (Math.random() < 0.01 && !document.querySelector('.golden-fish')) {
                spawnFish();
            }
        }

        function spawnFish() {
            const fish = document.createElement('div');
            fish.className = 'golden-fish';
            fish.textContent = 'üê†';
            fish.style.top = (Math.random() * 80 + 10) + '%';
            
            fish.onclick = () => {
                activateBonus();
                fish.remove();
            };
            
            document.body.appendChild(fish);
            setTimeout(() => { if(fish.parentNode) fish.remove(); }, 15000);
        }

        function activateBonus() {
            gameState.bonusMultiplier = 7;
            elements.frenzyOverlay.classList.add('active');
            showMessage("FRENESI DE OURO! 7x Ganhos! üê†");
            
            if (fishBonusTimeout) clearTimeout(fishBonusTimeout);
            
            fishBonusTimeout = setTimeout(() => {
                gameState.bonusMultiplier = 1;
                elements.frenzyOverlay.classList.remove('active');
                showMessage("Frenesi acabou.");
            }, 60000); 
        }

        // --- LOJA E ABAS ---

        function switchTab(tab) {
            gameState.activeTab = tab;
            updateTabVisuals();
            renderStore();
        }

        function updateTabVisuals() {
            [elements.tabBuildings, elements.tabUpgrades, elements.tabBoosts, elements.tabSpecials].forEach(el => el.classList.remove('active'));
            
            if(gameState.activeTab === 'buildings') elements.tabBuildings.classList.add('active');
            if(gameState.activeTab === 'upgrades') elements.tabUpgrades.classList.add('active');
            if(gameState.activeTab === 'boosts') elements.tabBoosts.classList.add('active');
            if(gameState.activeTab === 'specials') elements.tabSpecials.classList.add('active');
        }

        function updateStoreButtons() {
             let list = getActiveList();
             
             list.forEach(item => {
                 let btn = document.getElementById(`btn-item-${item.id}`);
                 if(!btn) return;
                 
                 if (gameState.activeTab === 'specials') {
                     if (gameState.goldenSachets >= item.costSachets) btn.classList.remove('disabled');
                     else btn.classList.add('disabled');
                     return;
                 }

                 if (gameState.activeTab === 'boosts') {
                     if (item.count > 0) return; // J√° comprado
                     if (gameState.score >= item.baseCost) btn.classList.remove('disabled');
                     else btn.classList.add('disabled');
                     return;
                 }

                 // L√≥gica Normal (Compra/Venda em Massa)
                 if (gameState.sellMode) {
                      const { refundAmount, count } = getBulkRefund(item, gameState.buyMultiplier);
                      if (count > 0) btn.classList.remove('disabled');
                      else btn.classList.add('disabled');
                 } else {
                      const { totalCost } = getBulkCost(item, gameState.buyMultiplier);
                      if (gameState.score >= totalCost) btn.classList.remove('disabled');
                      else btn.classList.add('disabled');
                 }
             });
        }
        
        function getActiveList() {
            if(gameState.activeTab === 'buildings') return gameState.buildings;
            if(gameState.activeTab === 'upgrades') return gameState.clickItems;
            if(gameState.activeTab === 'boosts') return gameState.boosts;
            if(gameState.activeTab === 'specials') return gameState.specials;
            return [];
        }

        function renderStore() {
            elements.storeContainer.innerHTML = "";
            let list = getActiveList();

            list.forEach(item => {
                const div = document.createElement('div');
                div.className = 'upgrade-item disabled';
                
                // Estilo para modo venda
                if (gameState.sellMode && gameState.activeTab !== 'specials' && gameState.activeTab !== 'boosts') {
                    div.classList.add('sell-mode');
                }
                
                // Estilo para Boosts comprados
                if (gameState.activeTab === 'boosts' && item.count > 0) {
                    div.classList.add('purchased');
                    div.classList.remove('disabled');
                    div.style.background = "#2a3c2a";
                    div.style.borderColor = "var(--green)";
                }

                div.id = `btn-item-${item.id}`;
                div.onclick = () => handleStoreItemClick(item);

                let costDisplay = "";
                let countDisplay = item.count;

                // --- RENDERIZA√á√ÉO ---
                if (gameState.activeTab === 'specials') {
                    costDisplay = `<span class="upgrade-cost sachet">üéí ${item.costSachets}</span>`;
                } else if (gameState.activeTab === 'boosts') {
                    costDisplay = item.count > 0 ? "COMPRADO" : `üß∂ ${formatNumber(item.baseCost)}`;
                    countDisplay = item.count > 0 ? "‚úî" : "";
                } else {
                    // Buildings ou Upgrades (Suporta Compra/Venda em Massa)
                    if (gameState.sellMode) {
                         const { refundAmount, count } = getBulkRefund(item, gameState.buyMultiplier);
                         costDisplay = `<span class="upgrade-cost refund">+${formatNumber(refundAmount)}</span>`;
                         if (count > 0) costDisplay += ` (Vender ${count})`;
                         else costDisplay = "Vazio";
                    } else {
                         const { totalCost, count } = getBulkCost(item, gameState.buyMultiplier);
                         costDisplay = `üß∂ ${formatNumber(totalCost)}`;
                         if (gameState.buyMultiplier === 'MAX') {
                             costDisplay += count > 0 ? ` (+${count})` : ` (+1)`;
                         } else if (gameState.buyMultiplier > 1) {
                             costDisplay += ` (x${gameState.buyMultiplier})`;
                         }
                    }
                }

                div.innerHTML = `
                    <div style="font-size: 2rem; margin-right: 15px;">${item.icon}</div>
                    <div style="flex: 1;">
                        <h3>${item.name}</h3>
                        <p>${costDisplay}</p>
                        <p style="font-size: 0.8rem; color:#aaa;">${item.desc || ('+' + item.cps + ' CPS')}</p>
                    </div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: rgba(255,255,255,0.2);">${countDisplay}</div>
                `;
                elements.storeContainer.appendChild(div);
            });
        }

        function handleStoreItemClick(item) {
            if (gameState.activeTab === 'specials') {
                buySpecial(item);
                return;
            }
            if (gameState.activeTab === 'boosts') {
                buyBoost(item);
                return;
            }

            if (gameState.sellMode) {
                sellItem(item);
            } else {
                buyItem(item);
            }
        }

        function buySpecial(item) {
            if (gameState.goldenSachets >= item.costSachets) {
                gameState.goldenSachets -= item.costSachets;
                item.count++;
                renderStore();
                showMessage("Item Especial Comprado!");
            }
        }

        function buyBoost(item) {
            if (item.count > 0) return;
            if (gameState.score >= item.baseCost) {
                gameState.score -= item.baseCost;
                item.count++;
                recalculateCPS();
                recalculateClickValue();
                renderStore();
                showMessage("Acess√≥rio desbloqueado!");
            }
        }

        function buyItem(item) {
            const { totalCost, count } = getBulkCost(item, gameState.buyMultiplier);
            
            if (gameState.buyMultiplier === 'MAX' && count === 0) return; // N√£o d√° pra comprar nenhum

            if (gameState.score >= totalCost) {
                gameState.score -= totalCost;
                item.count += count;
                
                if(gameState.activeTab === 'buildings') recalculateCPS();
                if(gameState.activeTab === 'upgrades') recalculateClickValue();

                renderStore();
                showMessage(`Comprado ${count}x ${item.name}!`);
            }
        }

        function sellItem(item) {
            const { refundAmount, count } = getBulkRefund(item, gameState.buyMultiplier);
            
            if (count > 0) {
                item.count -= count;
                gameState.score += refundAmount;
                
                if(gameState.activeTab === 'buildings') recalculateCPS();
                if(gameState.activeTab === 'upgrades') recalculateClickValue();

                renderStore();
                showMessage(`Vendido ${count}x ${item.name}!`);
            }
        }

        function recalculateCPS() {
            let cps = 0;
            gameState.buildings.forEach(b => {
                let multi = 1;
                // Check boosts
                gameState.boosts.forEach(bst => {
                    if ((bst.targetType === 'building' || !bst.targetType) && bst.targetId === b.id && bst.count > 0) multi *= bst.multiplier;
                });
                cps += b.count * b.cps * multi;
            });
            gameState.cps = cps;
        }

        function recalculateClickValue() {
            let val = 1;
            gameState.clickItems.forEach(i => {
                let multi = 1;
                gameState.boosts.forEach(bst => {
                    if (bst.targetType === 'click' && bst.targetId === i.id && bst.count > 0) multi *= bst.multiplier;
                });
                val += i.count * i.clickIncrease * multi;
            });
            gameState.clickValue = val;
        }

        // --- UTILS ---
        
        function formatNumber(num) {
            num = Number(num);
            if (num >= 1e18) return (num / 1e18).toFixed(2) + 'Q';
            if (num >= 1e15) return (num / 1e15).toFixed(2) + 'q';
            if (num >= 1e12) return (num / 1e12).toFixed(2) + 'T';
            if (num >= 1e9) return (num / 1e9).toFixed(2) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(2) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
            return Number.isInteger(num) ? num : num.toFixed(1);
        }

        function createParticles(x, y, text) {
            const p = document.createElement('div');
            p.className = 'floating-number';
            p.textContent = text;
            p.style.left = (x + (Math.random()*20-10)) + 'px';
            p.style.top = (y - 20) + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 1000);
        }

        function showMessage(msg) {
            if(elements.msgLog) {
                elements.msgLog.textContent = msg;
                elements.msgLog.style.opacity = 1;
                setTimeout(() => elements.msgLog.style.opacity = 0, 2000);
            }
        }

        function checkAchievements() {
            gameState.achievements.forEach(ach => {
                if (!ach.unlocked && ach.check(gameState)) {
                    ach.unlocked = true;
                    showAchievementToast(ach);
                }
            });
        }
        
        function showAchievementToast(ach) {
            document.getElementById('toast-text').textContent = ach.name;
            document.getElementById('achievement-toast').classList.add('show');
            setTimeout(() => document.getElementById('achievement-toast').classList.remove('show'), 3000);
        }
        
        function showAchievementsModal() {
             elements.achievementsContent.innerHTML = "";
             gameState.achievements.forEach(ach => {
                 const div = document.createElement('div');
                 div.className = `achievement-item ${ach.unlocked ? 'unlocked' : 'locked'}`;
                 div.style.padding = "10px";
                 div.style.marginBottom = "5px";
                 div.style.background = ach.unlocked ? "rgba(255,204,0,0.1)" : "rgba(255,255,255,0.05)";
                 div.innerHTML = `<span style="font-size:1.5rem; margin-right:10px;">${ach.unlocked ? ach.icon : 'üîí'}</span> <b>${ach.name}</b><br><small>${ach.desc}</small>`;
                 elements.achievementsContent.appendChild(div);
             });
             elements.achievementsModal.classList.remove('hidden');
        }
        
        function showStatsModal() {
            // Simplificado para espa√ßo
            let statsHTML = `
                <div class="stat-row"><span class="stat-label">Karma:</span> <span class="stat-value">${formatNumber(gameState.karma)}</span></div>
                <div class="stat-row"><span class="stat-label">Ascens√µes:</span> <span class="stat-value">${gameState.prestigeCount}</span></div>
                <div class="stat-row"><span class="stat-label">Cliques:</span> <span class="stat-value">${formatNumber(gameState.totalClicks)}</span></div>
            `;
            elements.statsContent.innerHTML = statsHTML;
            elements.statsModal.classList.remove('hidden');
        }

        // --- SAVE/LOAD ---
        
        function saveGame() {
            localStorage.setItem('catClickerSave', JSON.stringify(gameState));
        }
        
        function resetGameStateToDefaults() {
            // Helper para resetar objetos mantendo a refer√™ncia se necess√°rio, 
            // mas aqui no reload √© mais simples re-iniciar as vari√°veis globais manualmente se n√£o fizermos reload da pagina.
            // Para simplicidade deste arquivo unico, o reload da pagina √© a melhor op√ß√£o para limpar intervalos antigos.
            location.reload(); 
        }

        function performHardReset() {
            localStorage.removeItem('catClickerSave');
            location.reload();
        }

        function loadGame() {
            const saved = localStorage.getItem('catClickerSave');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    // Merge b√°sico para garantir que novos campos (karma, specials) existam
                    Object.assign(gameState, parsed);
                    
                    // Re-hidratar arrays complexos se necess√°rio (garantir que objetos novos existam no save antigo)
                    
                    // RE-APLICAR CONTAGEM DE BOOSTS SE EXISTIR
                    if (parsed.boosts && Array.isArray(parsed.boosts)) {
                        parsed.boosts.forEach(savedB => {
                            const realB = gameState.boosts.find(b => b.id === savedB.id);
                            if (realB) realB.count = savedB.count;
                        });
                    }
                    if (parsed.clickItems && Array.isArray(parsed.clickItems)) {
                        parsed.clickItems.forEach(savedB => {
                            const realB = gameState.clickItems.find(b => b.id === savedB.id);
                            if (realB) realB.count = savedB.count;
                        });
                    }
                     if (parsed.buildings && Array.isArray(parsed.buildings)) {
                        parsed.buildings.forEach(savedB => {
                            const realB = gameState.buildings.find(b => b.id === savedB.id);
                            if (realB) realB.count = savedB.count;
                        });
                    }
                    if (parsed.achievements && Array.isArray(parsed.achievements)) {
                         parsed.achievements.forEach(savedA => {
                            const realA = gameState.achievements.find(a => a.id === savedA.id);
                            if (realA) realA.unlocked = savedA.unlocked;
                        });
                    }
                    
                    recalculateCPS();
                    recalculateClickValue();
                    
                    // Visual
                    if(gameState.karma > 50) elements.bigCat.textContent = "üòº";
                } catch(e) { console.error(e); }
            }
        }

        function setSellMode(mode) { 
            gameState.sellMode = mode; 
            elements.btnModeBuy.classList.toggle('active', !mode);
            elements.btnModeSell.classList.toggle('sell-active', mode);
            renderStore();
        }
        function setBuyMultiplier(val) { 
            gameState.buyMultiplier = val; 
            elements.multiplierBtns.forEach(b => {
                // Check if button text matches val or if val is 'MAX'
                if (
                    (val === 'MAX' && b.textContent === 'M√°x') ||
                    (parseInt(b.textContent) === val)
                ) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });
            renderStore();
        }

        init();
    </script>
</body>
</html>
