<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mestre dos Gatos: Ascens√£o v3.1</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #121013;
            --bg-panel: rgba(40, 35, 40, 0.85);
            --accent: #ffcc00;
            --accent-glow: rgba(255, 204, 0, 0.5);
            --text-main: #ffffff;
            --text-dim: #a0a0a0;
            --green: #4cd964;
            --red: #ff453a;
            --purple: #bf5af2;
            --prestige: #00d2ff;
            --combo: #ff9500;
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; outline: none; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(191, 90, 242, 0.15) 0%, transparent 25%),
                radial-gradient(circle at 90% 80%, rgba(255, 204, 0, 0.15) 0%, transparent 25%);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ANIMA√á√ïES --- */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes goldenSpawn { 0% { transform: scale(0) rotate(180deg); opacity: 0; } 100% { transform: scale(1) rotate(0); opacity: 1; } }
        @keyframes fadeOutUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-60px); } }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        /* --- NEWS TICKER --- */
        .news-ticker {
            background: rgba(0,0,0,0.9);
            width: 100%; height: 28px;
            overflow: hidden; position: relative; z-index: 100;
            border-bottom: 1px solid #333; display: flex; align-items: center;
        }
        .ticker-content {
            white-space: nowrap; position: absolute;
            animation: tickerMove 25s linear infinite;
            font-size: 0.85rem; color: #ddd; font-style: italic;
        }
        @keyframes tickerMove { 0% { left: 100%; } 100% { left: -100%; } }

        /* --- UI GERAL --- */
        .game-layout { display: flex; flex: 1; height: calc(100% - 28px); position: relative; }

        /* ESQUERDA: O GATO */
        .left-panel {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            position: relative; z-index: 10;
        }

        .score-container { text-align: center; margin-bottom: 1rem; position: relative; width: 100%; }

        .main-score {
            font-family: 'Fredoka One', cursive; font-size: 3.5rem;
            color: var(--accent); text-shadow: 0 0 20px var(--accent-glow);
            line-height: 1;
        }

        .cps-label { font-size: 1rem; color: var(--text-dim); margin-top: 5px; font-weight: 700; }
        .cps-detail { font-size: 0.8rem; color: #666; font-weight: normal; }
        
        .prestige-currency {
            color: var(--prestige); font-size: 0.9rem; font-weight: bold;
            margin-top: 5px; display: none; text-shadow: 0 0 10px rgba(0, 210, 255, 0.4);
        }

        /* BARRA DE COMBO */
        .combo-container {
            width: 300px; height: 10px; background: rgba(255,255,255,0.1);
            border-radius: 10px; margin: 10px auto; overflow: hidden; position: relative;
            display: none; /* Aparece ao clicar */
        }
        .combo-fill {
            height: 100%; width: 0%; background: linear-gradient(90deg, #ff9500, #ffcc00);
            transition: width 0.1s linear; box-shadow: 0 0 10px #ff9500;
        }
        .combo-text {
            font-size: 0.9rem; color: var(--combo); font-weight: bold; margin-top: 2px;
            height: 20px; opacity: 0; transition: opacity 0.2s;
        }

        .cat-area {
            position: relative; cursor: pointer;
            transition: transform 0.05s; -webkit-tap-highlight-color: transparent;
            margin: 20px 0;
        }
        .cat-emoji {
            font-size: 13rem; filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
            transition: all 0.2s; display: inline-block;
        }
        .cat-area:active .cat-emoji { transform: scale(0.90) rotate(-3deg); }
        .cat-area.shake .cat-emoji { animation: shake 0.5s; }

        /* DIREITA: LOJA */
        .right-panel {
            width: 400px; background: var(--bg-panel);
            backdrop-filter: blur(15px); border-left: var(--glass-border);
            display: flex; flex-direction: column; position: relative;
            box-shadow: -10px 0 50px rgba(0,0,0,0.5); z-index: 20;
        }

        .store-header { padding: 15px; background: rgba(0,0,0,0.3); border-bottom: var(--glass-border); }
        .tab-container { display: flex; gap: 5px; margin-bottom: 10px; }
        
        .tab-btn {
            flex: 1; padding: 8px; background: rgba(255,255,255,0.05);
            border: none; color: var(--text-dim); font-weight: bold;
            border-radius: 6px; cursor: pointer; transition: 0.2s;
            font-family: 'Nunito', sans-serif; font-size: 0.9rem;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.1); }
        .tab-btn.active { background: var(--accent); color: #121013; box-shadow: 0 0 15px var(--accent-glow); }

        .multiplier-controls { display: flex; justify-content: center; gap: 5px; font-size: 0.8rem; }
        .mult-btn {
            background: transparent; border: 1px solid #555; color: #777;
            padding: 2px 8px; border-radius: 4px; cursor: pointer;
        }
        .mult-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(255, 204, 0, 0.1); }

        .store-list { flex: 1; overflow-y: auto; padding: 10px; }
        .store-list::-webkit-scrollbar { width: 6px; }
        .store-list::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        .store-item {
            background: rgba(255,255,255,0.03); border: var(--glass-border);
            border-radius: 8px; padding: 10px; margin-bottom: 8px;
            display: flex; align-items: center; cursor: pointer;
            transition: all 0.2s; position: relative;
        }
        .store-item:hover { transform: translateX(-3px); background: rgba(255,255,255,0.07); }
        .store-item.disabled { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }
        .store-item.purchased { background: rgba(76, 217, 100, 0.1); border-color: var(--green); }

        .item-icon { font-size: 1.8rem; margin-right: 12px; min-width: 40px; text-align: center; }
        .item-details { flex: 1; }
        .item-name { font-weight: 800; font-size: 0.95rem; color: #fff; }
        .item-cost { color: var(--red); font-weight: bold; font-size: 0.85rem; }
        .item-bonus { font-size: 0.75rem; color: var(--text-dim); }
        .item-count { font-size: 1.4rem; font-weight: 900; color: rgba(255,255,255,0.1); margin-left: 10px; }

        /* Gato Dourado */
        .golden-cat {
            position: absolute; font-size: 4rem; cursor: pointer;
            z-index: 999; filter: drop-shadow(0 0 20px gold);
            animation: goldenSpawn 0.5s ease-out;
        }

        /* Achievements */
        .achievement-container {
            position: fixed; bottom: 20px; left: 20px; z-index: 2000;
            display: flex; flex-direction: column; gap: 10px; pointer-events: none;
        }
        .achievement-toast {
            background: rgba(30, 30, 30, 0.95); border-left: 4px solid var(--accent);
            padding: 12px; border-radius: 4px; color: #fff; width: 280px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            animation: slideInRight 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex; align-items: center;
        }

        /* Part√≠culas */
        .particle {
            position: absolute; pointer-events: none; font-weight: 900;
            font-size: 1.2rem; animation: fadeOutUp 0.8s forwards;
            color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.8); z-index: 100;
        }
        .particle.crit { color: var(--combo); font-size: 1.8rem; text-shadow: 0 0 10px var(--combo); }

        /* MODAIS */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(8px);
            z-index: 3000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .modal {
            background: #252025; padding: 2rem; border-radius: 15px;
            width: 90%; max-width: 450px; text-align: center;
            border: 1px solid #444; box-shadow: 0 0 50px rgba(0,0,0,0.8);
            transform: scale(0.9); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; overflow-y: auto;
        }
        .modal-overlay.active .modal { transform: scale(1); }

        .modal h2 { font-family: 'Fredoka One'; color: var(--accent); margin-bottom: 15px; font-size: 1.8rem; }
        .modal p { color: #ccc; margin-bottom: 20px; font-size: 0.95rem; line-height: 1.5; }
        
        .modal-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;
        }
        .skin-btn {
            background: rgba(255,255,255,0.05); border: 2px solid transparent;
            border-radius: 8px; padding: 10px; cursor: pointer; transition: 0.2s;
        }
        .skin-btn:hover { background: rgba(255,255,255,0.1); }
        .skin-btn.active { border-color: var(--accent); background: rgba(255,204,0,0.1); }
        .skin-btn.locked { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

        .btn {
            padding: 10px 20px; border: none; border-radius: 50px;
            font-weight: bold; font-size: 0.9rem; cursor: pointer;
            transition: 0.2s; font-family: 'Nunito'; background: #444; color: #fff;
            margin: 5px;
        }
        .btn:hover { transform: scale(1.05); filter: brightness(1.2); }
        .btn-primary { background: var(--accent); color: #121013; }
        .btn-danger { background: var(--red); color: white; }
        .btn-prestige { background: var(--prestige); color: #003344; box-shadow: 0 0 15px rgba(0, 210, 255, 0.3); }

        /* Controles Inferiores */
        .bottom-controls {
            position: absolute; bottom: 20px; display: flex; gap: 15px;
            padding: 10px 20px; background: rgba(0,0,0,0.4); border-radius: 30px;
            backdrop-filter: blur(5px);
        }
        .ctrl-btn {
            background: transparent; border: none; color: #aaa; font-size: 1.5rem;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .ctrl-btn:hover { color: #fff; transform: translateY(-3px); }
        .ctrl-btn::after {
            content: attr(title); position: absolute; bottom: 120%; left: 50%;
            transform: translateX(-50%); background: #000; color: #fff;
            padding: 4px 8px; font-size: 0.7rem; border-radius: 4px;
            opacity: 0; pointer-events: none; transition: 0.2s; white-space: nowrap;
        }
        .ctrl-btn:hover::after { opacity: 1; }

        .stats-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem; }
        .stats-row:last-child { border: none; }
        .stats-val { font-weight: bold; color: #fff; }

        /* Input de texto para import */
        .import-area { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-family: monospace; resize: none; height: 80px; }

        @media (max-width: 800px) {
            .game-layout { flex-direction: column; overflow-y: auto; }
            .right-panel { width: 100%; height: auto; border-left: none; border-top: 1px solid #333; padding-bottom: 80px; }
            .cat-emoji { font-size: 9rem; margin: 10px 0; }
            .bottom-controls { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); z-index: 100; width: 90%; justify-content: space-around; }
            .main-score { font-size: 2.8rem; }
        }
    </style>
</head>
<body>

    <!-- NOT√çCIAS -->
    <div class="news-ticker">
        <div class="ticker-content" id="ticker">Bem-vindo ao Mestre dos Gatos! Comece a clicar!</div>
    </div>

    <div class="game-layout">
        <!-- ESQUERDA -->
        <section class="left-panel">
            <div class="score-container">
                <div class="main-score" id="score">0</div>
                <div class="cps-label">Ronrons por segundo: <span id="cps">0.0</span></div>
                <div class="prestige-currency" id="prestige-display">üß∂ Novelos de Ouro: 0</div>
                
                <!-- Sistema de Combo -->
                <div class="combo-container" id="combo-bar-container">
                    <div class="combo-fill" id="combo-fill"></div>
                </div>
                <div class="combo-text" id="combo-text">COMBO x1.0</div>
            </div>

            <div class="cat-area" id="cat-clicker">
                <div class="cat-emoji" id="cat-emoji">üê±</div>
            </div>

            <div class="bottom-controls">
                <button class="ctrl-btn" id="btn-stats" title="Estat√≠sticas">üìä</button>
                <button class="ctrl-btn" id="btn-skins" title="Guarda-Roupa">üëï</button>
                <button class="ctrl-btn" id="btn-prestige" title="Ascens√£o" style="color:var(--prestige);">üåÄ</button>
                <button class="ctrl-btn" id="btn-settings" title="Configura√ß√µes">‚öôÔ∏è</button>
            </div>
        </section>

        <!-- DIREITA -->
        <section class="right-panel">
            <div class="store-header">
                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('buildings')">Estruturas</button>
                    <button class="tab-btn" onclick="switchTab('upgrades')">Upgrades</button>
                    <button class="tab-btn" onclick="switchTab('boosts')">Acess√≥rios</button>
                </div>
                <div class="multiplier-controls">
                    <span>Comprar:</span>
                    <button class="mult-btn active" onclick="setMultiplier(1)">1x</button>
                    <button class="mult-btn" onclick="setMultiplier(10)">10x</button>
                    <button class="mult-btn" onclick="setMultiplier(100)">100x</button>
                </div>
            </div>
            <div class="store-list" id="store-list">
                <!-- Itens gerados via JS -->
            </div>
        </section>
    </div>

    <!-- Container de Achievements -->
    <div class="achievement-container" id="achievement-container"></div>

    <!-- MODAL SKINS -->
    <div class="modal-overlay" id="modal-skins">
        <div class="modal">
            <h2>Guarda-Roupa Felino</h2>
            <p>Desbloqueie novas apar√™ncias para seu gato.</p>
            <div class="modal-grid" id="skins-grid">
                <!-- Skins geradas via JS -->
            </div>
            <button class="btn" onclick="toggleModal('modal-skins')">Fechar</button>
        </div>
    </div>

    <!-- MODAL STATS -->
    <div class="modal-overlay" id="modal-stats">
        <div class="modal">
            <h2>Estat√≠sticas üìä</h2>
            <div id="stats-content">
                <!-- Dados via JS -->
            </div>
            <br>
            <button class="btn" onclick="toggleModal('modal-stats')">Fechar</button>
        </div>
    </div>

    <!-- MODAL SETTINGS -->
    <div class="modal-overlay" id="modal-settings">
        <div class="modal">
            <h2>Configura√ß√µes ‚öôÔ∏è</h2>
            
            <div style="margin-bottom: 20px;">
                <button class="btn" id="btn-toggle-audio" onclick="toggleAudio()">üîä Som: Ligado</button>
            </div>

            <hr style="border: 0; border-top: 1px solid #444; margin: 15px 0;">
            
            <p>Salvar / Carregar</p>
            <button class="btn btn-primary" onclick="exportSave()">Exportar Save (Copiar)</button>
            <button class="btn" onclick="openImport()">Importar Save</button>

            <div id="import-section" style="display:none; margin-top:10px;">
                <textarea class="import-area" id="import-text" placeholder="Cole o c√≥digo do save aqui..."></textarea>
                <button class="btn btn-primary" onclick="importSave()">Carregar</button>
            </div>

            <hr style="border: 0; border-top: 1px solid #444; margin: 15px 0;">

            <button class="btn btn-danger" onclick="hardReset()">‚ö†Ô∏è APAGAR TUDO</button>
            <br><br>
            <button class="btn" onclick="toggleModal('modal-settings')">Fechar</button>
        </div>
    </div>

    <!-- MODAL PRESTIGIO -->
    <div class="modal-overlay" id="modal-prestige">
        <div class="modal">
            <h2>Ascens√£o C√≥smica üåÄ</h2>
            <p>Resetar reinicia seu dinheiro e estruturas, mas mant√©m conquistas, skins e acess√≥rios.</p>
            <p>Cada Novelo de Ouro aumenta o CPS em <b>+10%</b>.</p>
            <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:8px; margin-bottom:20px;">
                <p style="margin:0; font-size:0.9rem; color:#aaa;">Recompensa ao resetar:</p>
                <h3 style="color:var(--prestige); font-size:2.5rem; margin:5px 0;" id="prestige-reward-amount">+0</h3>
                <p style="margin:0; font-size:0.8rem; color:#aaa;">Novelos de Ouro</p>
            </div>
            <button class="btn btn-prestige" onclick="doPrestige()">Resetar e Ascender</button>
            <button class="btn" onclick="toggleModal('modal-prestige')">Cancelar</button>
        </div>
    </div>

    <!-- MODAL OFFLINE/DAILY -->
    <div class="modal-overlay" id="modal-offline">
        <div class="modal">
            <h2 id="modal-offline-title">Bem-vindo de volta!</h2>
            <p id="modal-offline-msg">Seus gatos trabalharam.</p>
            <h3 style="color:var(--accent); font-size:2.5rem;" id="offline-gains">+0</h3>
            <button class="btn btn-primary" onclick="toggleModal('modal-offline')">Coletar</button>
        </div>
    </div>

    <script>
        // --- SISTEMA DE √ÅUDIO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let audioEnabled = true;
        
        function playSound(type) {
            if (!audioEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'click') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'buy') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(1200, now);
                osc.frequency.linearRampToValueAtTime(1800, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'golden') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.linearRampToValueAtTime(1500, now + 0.5);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            }
        }

        function toggleAudio() {
            audioEnabled = !audioEnabled;
            const btn = document.getElementById('btn-toggle-audio');
            btn.innerText = audioEnabled ? "üîä Som: Ligado" : "üîá Som: Desligado";
            btn.style.opacity = audioEnabled ? "1" : "0.5";
        }

        // --- DADOS DO JOGO ---
        const defaultGame = {
            score: 0,
            totalScore: 0,
            startTime: Date.now(),
            lastSave: Date.now(),
            prestigeCurrency: 0,
            prestigeCount: 0,
            totalClicks: 0,
            maxCombo: 0,
            activeSkin: 'üê±',
            buildings: [
                { id: 'b0', name: 'M√£o Humana', baseCost: 15, cps: 0.1, count: 0, icon: 'üëÜ' },
                { id: 'b1', name: 'Caixa de Papel√£o', baseCost: 100, cps: 1, count: 0, icon: 'üì¶' },
                { id: 'b2', name: 'Arranhador', baseCost: 1100, cps: 8, count: 0, icon: 'üß∂' },
                { id: 'b3', name: 'Jardim de Catnip', baseCost: 12000, cps: 47, count: 0, icon: 'üåø' },
                { id: 'b4', name: 'F√°brica de Sach√™', baseCost: 130000, cps: 260, count: 0, icon: 'üè≠' },
                { id: 'b5', name: 'Ex√©rcito Felino', baseCost: 1400000, cps: 1400, count: 0, icon: 'üòº' },
                { id: 'b6', name: 'Templo Bastet', baseCost: 20000000, cps: 7800, count: 0, icon: 'üèõÔ∏è' },
                { id: 'b7', name: 'Planeta Miau', baseCost: 330000000, cps: 44000, count: 0, icon: 'ü™ê' },
                { id: 'b8', name: 'Dimens√£o Gat√°stica', baseCost: 5100000000, cps: 260000, count: 0, icon: 'üåå' }
            ],
            clickUpgrades: [
                { id: 'u0', name: 'Cortar Unhas', cost: 500, power: 1, count: 0, icon: 'üíÖ' },
                { id: 'u1', name: 'Luva de Escovar', cost: 5000, power: 5, count: 0, icon: 'üß§' },
                { id: 'u2', name: 'Laser Pointer', cost: 50000, power: 25, count: 0, icon: 'üî¶' },
                { id: 'u3', name: 'Varinha M√°gica', cost: 1000000, power: 100, count: 0, icon: 'ü™Ñ' }
            ],
            boosts: [
                { id: 'bst0', name: 'Leite Premium', cost: 5000, target: 'b0', mult: 2, owned: false, icon: 'ü•õ' },
                { id: 'bst1', name: 'Caixa Dupla', cost: 25000, target: 'b1', mult: 2, owned: false, icon: 'üì¶' },
                { id: 'bst2', name: 'Catnip OGM', cost: 100000, target: 'b3', mult: 2, owned: false, icon: 'üß™' },
                { id: 'bst3', name: 'Automa√ß√£o', cost: 5000000, target: 'b4', mult: 2, owned: false, icon: '‚öôÔ∏è' }
            ],
            achievements: [
                { id: 'ach0', name: 'Iniciante', req: 100, type: 'score', unlocked: false, desc: '100 ronrons' },
                { id: 'ach1', name: 'Louco dos Gatos', req: 50, type: 'building', unlocked: false, desc: '50 estruturas' },
                { id: 'ach2', name: 'Milion√°rio', req: 1000000, type: 'score', unlocked: false, desc: '1 milh√£o de ronrons' },
                { id: 'ach3', name: 'Ascendido', req: 1, type: 'prestige', unlocked: false, desc: 'Fa√ßa 1 ascens√£o' }
            ],
            skins: [
                { id: 's0', icon: 'üê±', name: 'Cl√°ssico', unlocked: true, type: 'default' },
                { id: 's1', icon: 'üòº', name: 'Astuto', unlocked: false, type: 'ach', reqId: 'ach1' },
                { id: 's2', icon: 'üòø', name: 'Sad Boy', unlocked: false, type: 'ach', reqId: 'ach0' },
                { id: 's3', icon: 'üòª', name: 'Apaixonado', unlocked: false, type: 'buy', cost: 1, currency: 'gold' },
                { id: 's4', icon: 'üôÄ', name: 'Assustado', unlocked: false, type: 'buy', cost: 3, currency: 'gold' },
                { id: 's5', icon: 'ü§ñ', name: 'Robo-Cat', unlocked: false, type: 'ach', reqId: 'ach2' },
                { id: 's6', icon: 'ü¶Å', name: 'O Rei', unlocked: false, type: 'buy', cost: 10, currency: 'gold' },
                { id: 's7', icon: 'üëΩ', name: 'Alien', unlocked: false, type: 'ach', reqId: 'ach3' },
                { id: 's8', icon: 'üí©', name: 'Oops', unlocked: false, type: 'buy', cost: 100, currency: 'gold' }
            ]
        };

        let game = JSON.parse(JSON.stringify(defaultGame));
        
        // Estado da UI
        let currentTab = 'buildings';
        let buyMultiplier = 1;
        let globalCPS = 0;
        let clickPower = 1;
        let clickIncomeHistory = []; // Para armazenar ganhos de clique no √∫ltimo segundo
        
        // Combo System
        let comboValue = 0;
        let comboTimer = 0;
        let comboMultiplier = 1;

        // --- CORE LOGIC ---
        function init() {
            loadGame();
            
            // Garantir que skins existam em saves antigos
            if(!game.skins || game.skins.length < defaultGame.skins.length) {
                game.skins = JSON.parse(JSON.stringify(defaultGame.skins));
            }

            recalcStats();
            renderStore();
            updateCatSkin();

            setInterval(gameLoop, 100); 
            setInterval(saveGame, 30000); 
            setInterval(trySpawnGoldenCat, 60000); 
            setInterval(updateTicker, 15000);
            
            checkOfflineProgress();
            
            // Setup Listeners
            document.getElementById('cat-clicker').addEventListener('pointerdown', clickCat);
            
            // Bot√µes do menu inferior
            document.getElementById('btn-stats').onclick = openStats;
            document.getElementById('btn-skins').onclick = openSkins;
            document.getElementById('btn-prestige').onclick = openPrestigeModal;
            document.getElementById('btn-settings').onclick = () => toggleModal('modal-settings');
        }

        function gameLoop() {
            // Ganho passivo
            const gain = globalCPS / 10;
            if (gain > 0) {
                game.score += gain;
                game.totalScore += gain;
            }

            // Combo Decay
            if (comboValue > 0) {
                comboTimer += 100;
                if (comboTimer > 1500) { // 1.5s sem clicar = perde combo
                    comboValue -= 2;
                    if (comboValue < 0) comboValue = 0;
                    updateComboUI();
                }
            }

            updateUI();
            checkAchievements();
        }

        function clickCat(e) {
            playSound('click');
            game.totalClicks++;
            
            // Combo Logic
            comboValue++;
            if (comboValue > 100) comboValue = 100;
            if (comboValue > game.maxCombo) game.maxCombo = comboValue;
            comboTimer = 0;
            updateComboUI();

            // Calculate Gain
            let isCrit = Math.random() < 0.02; // 2% crit
            let amount = clickPower * comboMultiplier * (isCrit ? 5 : 1);
            
            // Registra ganho para o CPS din√¢mico
            clickIncomeHistory.push({ time: Date.now(), amount: amount });

            game.score += amount;
            game.totalScore += amount;

            // Visuals
            createParticle(e.clientX, e.clientY, `+${formatNumber(amount)}`, isCrit);
            
            const cat = document.getElementById('cat-emoji');
            cat.style.transform = 'scale(0.9)';
            if(isCrit) document.getElementById('cat-area').classList.add('shake');
            setTimeout(() => {
                cat.style.transform = 'scale(1)';
                document.getElementById('cat-area').classList.remove('shake');
            }, 50);
        }

        function updateComboUI() {
            const container = document.getElementById('combo-bar-container');
            const fill = document.getElementById('combo-fill');
            const text = document.getElementById('combo-text');

            if (comboValue > 0) {
                container.style.display = 'block';
                text.style.opacity = 1;
                fill.style.width = comboValue + '%';
                
                // Multiplier math: 1 + (combo / 20) -> Max 6x com 100 combo
                comboMultiplier = 1 + (comboValue / 20);
                text.innerText = `COMBO x${comboMultiplier.toFixed(1)}`;
            } else {
                text.style.opacity = 0;
                comboMultiplier = 1;
                setTimeout(() => { if(comboValue === 0) container.style.display = 'none'; }, 200);
            }
        }

        // --- SKINS SYSTEM ---
        function openSkins() {
            const grid = document.getElementById('skins-grid');
            grid.innerHTML = '';
            
            game.skins.forEach((skin, index) => {
                const btn = document.createElement('div');
                let className = 'skin-btn';
                if (game.activeSkin === skin.icon) className += ' active';
                if (!skin.unlocked) className += ' locked';
                
                btn.className = className;
                btn.innerHTML = `
                    <div style="font-size:2rem;">${skin.icon}</div>
                    <div style="font-size:0.8rem; margin-top:5px;">${skin.name}</div>
                    ${!skin.unlocked && skin.type === 'buy' ? `<div style="font-size:0.7rem; color:var(--accent)">${skin.cost} üß∂</div>` : ''}
                    ${!skin.unlocked && skin.type === 'ach' ? `<div style="font-size:0.7rem; color:#aaa;">Bloqueado</div>` : ''}
                `;

                btn.onclick = () => selectSkin(index);
                grid.appendChild(btn);
            });

            toggleModal('modal-skins');
        }

        function selectSkin(index) {
            const skin = game.skins[index];
            if (skin.unlocked) {
                game.activeSkin = skin.icon;
                updateCatSkin();
                openSkins(); // Re-render to update active class
            } else if (skin.type === 'buy') {
                if (game.prestigeCurrency >= skin.cost) {
                    game.prestigeCurrency -= skin.cost;
                    skin.unlocked = true;
                    game.activeSkin = skin.icon;
                    playSound('buy');
                    recalcStats(); // Atualiza display de novelos
                    updateCatSkin();
                    openSkins();
                } else {
                    spawnToast('Ops', 'Novelos insuficientes!');
                }
            } else {
                spawnToast('Bloqueado', 'Complete a conquista necess√°ria.');
            }
        }

        function updateCatSkin() {
            document.getElementById('cat-emoji').innerText = game.activeSkin;
        }

        // --- STATS SYSTEM ---
        function recalcStats() {
            // Base CPS
            let cps = 0;
            game.buildings.forEach(b => {
                let multiplier = 1;
                game.boosts.forEach(bst => {
                    if (bst.owned && bst.target === b.id) multiplier *= bst.mult;
                });
                cps += b.count * b.cps * multiplier;
            });

            // Base Click Power
            let cPower = 1;
            game.clickUpgrades.forEach(u => {
                cPower += u.count * u.power;
            });

            // Prestige Multiplier (10% por novelo)
            const prestigeMult = 1 + (game.prestigeCurrency * 0.10);
            
            globalCPS = cps * prestigeMult;
            clickPower = cPower * prestigeMult;

            // Update Prestige Display
            const pDisplay = document.getElementById('prestige-display');
            if (game.prestigeCurrency > 0 || game.prestigeCount > 0) {
                pDisplay.style.display = 'block';
                pDisplay.innerText = `üß∂ Novelos de Ouro: ${formatNumber(game.prestigeCurrency)} (+${formatNumber(game.prestigeCurrency * 10)}%)`;
            } else {
                pDisplay.style.display = 'none';
            }
        }

        function openStats() {
            const content = document.getElementById('stats-content');
            const now = Date.now();
            const hours = ((now - game.startTime) / 3600000).toFixed(1);
            
            content.innerHTML = `
                <div class="stats-row"><span class="stats-lbl">Ronrons Totais:</span><span class="stats-val">${formatNumber(game.totalScore)}</span></div>
                <div class="stats-row"><span class="stats-lbl">Total de Cliques:</span><span class="stats-val">${formatNumber(game.totalClicks)}</span></div>
                <div class="stats-row"><span class="stats-lbl">Maior Combo:</span><span class="stats-val">x${(1 + game.maxCombo/20).toFixed(2)}</span></div>
                <div class="stats-row"><span class="stats-lbl">Ascens√µes:</span><span class="stats-val">${game.prestigeCount}</span></div>
                <div class="stats-row"><span class="stats-lbl">Tempo Jogado:</span><span class="stats-val">${hours} horas</span></div>
                <div class="stats-row"><span class="stats-lbl">Estruturas:</span><span class="stats-val">${game.buildings.reduce((a,b)=>a+b.count,0)}</span></div>
            `;
            toggleModal('modal-stats');
        }

        // --- STORE LOGIC ---
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderStore();
        }

        function setMultiplier(m) {
            buyMultiplier = m;
            document.querySelectorAll('.mult-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderStore();
        }

        // Nova fun√ß√£o para calcular pre√ßo de upgrade em massa
        function getUpgradeCost(u, count) {
            let total = 0;
            let currentCost = Math.floor(u.cost * Math.pow(1.5, u.count)); 
            let currentLevel = u.count;
            
            for(let i=0; i<count; i++) {
                total += Math.floor(u.cost * Math.pow(1.5, currentLevel + i));
            }
            return total;
        }

        function renderStore() {
            const list = document.getElementById('store-list');
            list.innerHTML = '';

            let items = [];
            if (currentTab === 'buildings') items = game.buildings;
            else if (currentTab === 'upgrades') items = game.clickUpgrades;
            else if (currentTab === 'boosts') items = game.boosts;

            items.forEach((item, index) => {
                // Filtro para boosts j√° comprados
                if (currentTab === 'boosts' && item.owned) return;

                const el = document.createElement('div');
                let cost, name, desc, owned, canBuy;

                if (currentTab === 'buildings') {
                    cost = getBuildingCost(item, buyMultiplier);
                    name = item.name;
                    desc = `+${formatNumber(item.cps * buyMultiplier)} CPS`;
                    owned = item.count;
                    canBuy = game.score >= cost;
                } else if (currentTab === 'upgrades') {
                    // Custo agora usa fun√ß√£o de massa
                    cost = getUpgradeCost(item, buyMultiplier); 
                    name = item.name;
                    desc = `+${item.power * buyMultiplier} Clique`;
                    owned = item.count;
                    canBuy = game.score >= cost;
                } else {
                    cost = item.cost;
                    name = item.name;
                    desc = `x${item.mult} produ√ß√£o`;
                    owned = "";
                    canBuy = game.score >= cost;
                }

                el.className = `store-item ${canBuy ? '' : 'disabled'}`;
                el.onclick = () => buyItem(currentTab, index);
                
                el.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-details">
                        <div class="item-name">${name}</div>
                        <div class="item-cost">${formatNumber(cost)} üß∂</div>
                        <div class="item-bonus">${desc}</div>
                    </div>
                    <div class="item-count">${owned}</div>
                `;
                list.appendChild(el);
            });
            
            // Mensagem se n√£o houver boosts
            if (currentTab === 'boosts' && items.every(i => i.owned)) {
                list.innerHTML = '<div style="text-align:center; padding:20px; color:#777;">Tudo comprado!</div>';
            }
        }

        function getBuildingCost(b, count) {
            let total = 0;
            let currentCost = b.baseCost * Math.pow(1.15, b.count);
            for(let i=0; i<count; i++) {
                total += currentCost;
                currentCost *= 1.15;
            }
            return Math.floor(total);
        }

        function buyItem(type, index) {
            playSound('buy');
            if (type === 'buildings') {
                const b = game.buildings[index];
                const cost = getBuildingCost(b, buyMultiplier);
                if (game.score >= cost) {
                    game.score -= cost;
                    b.count += buyMultiplier;
                    recalcStats(); renderStore();
                }
            } else if (type === 'upgrades') {
                const u = game.clickUpgrades[index];
                // Compra agora usa custo e l√≥gica de massa
                const cost = getUpgradeCost(u, buyMultiplier);
                if (game.score >= cost) {
                    game.score -= cost;
                    u.count += buyMultiplier;
                    recalcStats(); renderStore();
                }
            } else if (type === 'boosts') {
                const bst = game.boosts[index];
                if (!bst.owned && game.score >= bst.cost) {
                    game.score -= bst.cost;
                    bst.owned = true;
                    recalcStats(); renderStore();
                    spawnToast('Upgrade!', `Voc√™ comprou ${bst.name}`);
                }
            }
        }

        // --- PRESTIGE ---
        function openPrestigeModal() {
            const potential = Math.floor(Math.cbrt(game.totalScore / 1000000));
            const gain = Math.max(0, potential - game.prestigeCurrency);
            document.getElementById('prestige-reward-amount').innerText = `+${formatNumber(gain)}`;
            toggleModal('modal-prestige');
        }

        function doPrestige() {
            const potential = Math.floor(Math.cbrt(game.totalScore / 1000000));
            const gain = Math.max(0, potential - game.prestigeCurrency);
            
            if (gain > 0) {
                game.prestigeCurrency += gain;
                game.prestigeCount++;
                
                // Reset Logica
                game.score = 0;
                game.buildings.forEach(b => b.count = 0);
                game.clickUpgrades.forEach(u => u.count = 0);
                // game.boosts.forEach(b => b.owned = false); // Decis√£o de design: n√£o resetar boosts nessa vers√£o v3

                recalcStats();
                renderStore();
                toggleModal('modal-prestige');
                spawnToast('Ascens√£o!', 'O universo foi resetado.');
            } else {
                toggleModal('modal-prestige');
                spawnToast('Ascens√£o Falhou', 'Voc√™ precisa de mais ronrons.');
            }
        }

        // --- SETTINGS / SAVE ---
        function exportSave() {
            saveGame();
            const saveStr = btoa(JSON.stringify(game));
            navigator.clipboard.writeText(saveStr).then(() => {
                spawnToast('Sucesso', 'Save copiado para a √°rea de transfer√™ncia!');
            });
        }

        function openImport() {
            document.getElementById('import-section').style.display = 'block';
        }

        function importSave() {
            try {
                const str = document.getElementById('import-text').value;
                const json = JSON.parse(atob(str));
                if (json.score !== undefined) {
                    game = json;
                    saveGame();
                    location.reload();
                } else {
                    alert("Save inv√°lido!");
                }
            } catch(e) {
                alert("Erro ao importar save.");
            }
        }

        function hardReset() {
            if(confirm("TEM CERTEZA? Isso apaga TODO o progresso para sempre.")) {
                localStorage.removeItem('mestreGatosSave_v3');
                location.reload();
            }
        }

        // --- UTILS ---
        function updateUI() {
            // Calcula CPS Ativo (Cliques do √∫ltimo segundo)
            const now = Date.now();
            clickIncomeHistory = clickIncomeHistory.filter(c => now - c.time < 1000);
            const activeCPS = clickIncomeHistory.reduce((acc, c) => acc + c.amount, 0);
            const totalDisplayCPS = globalCPS + activeCPS;

            document.getElementById('score').innerText = formatNumber(Math.floor(game.score));
            
            // Texto detalhado de CPS
            const cpsEl = document.getElementById('cps');
            cpsEl.innerHTML = `${formatNumber(totalDisplayCPS.toFixed(1))} <span class="cps-detail">(Passivo: ${formatNumber(globalCPS.toFixed(1))})</span>`;
            
            document.title = `${formatNumber(Math.floor(game.score))} Ronrons - v3`;
        }

        function createParticle(x, y, text, isCrit) {
            const el = document.createElement('div');
            el.className = `particle ${isCrit ? 'crit' : ''}`;
            el.innerText = text;
            el.style.left = (x - 20 + Math.random()*40-20) + 'px';
            el.style.top = (y - 30) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        function spawnToast(title, msg) {
            const container = document.getElementById('achievement-container');
            const el = document.createElement('div');
            el.className = 'achievement-toast';
            el.innerHTML = `<div><div style="font-weight:bold; color:var(--accent)">${title}</div><div style="font-size:0.9rem">${msg}</div></div>`;
            container.appendChild(el);
            setTimeout(() => {
                el.style.animation = 'fadeOutUp 0.5s forwards';
                setTimeout(() => el.remove(), 500);
            }, 3000);
        }

        function toggleModal(id) {
            document.getElementById(id).classList.toggle('active');
        }

        function formatNumber(num) {
            if (num < 1000) return Math.floor(num);
            const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi"];
            const suffixNum = Math.floor(("" + Math.floor(num)).length / 3);
            let shortValue = parseFloat((suffixNum != 0 ? (num / Math.pow(1000, suffixNum)) : num).toPrecision(3));
            if (shortValue % 1 != 0) shortValue = shortValue.toFixed(1);
            return shortValue + suffixes[suffixNum];
        }

        // --- TICKER & EVENTS ---
        const newsLines = [
            "Gato derruba caneca e culpa o vento.",
            "Mercado de papel√£o sobe 500%.",
            "Cientistas descobrem que ronrons curam tristeza.",
            "Seu imp√©rio felino √© vis√≠vel da lua.",
            "Cachorros pedem tr√©gua mundial.",
            "Novo decreto: Sach√™ obrigat√≥rio √†s 15h."
        ];
        function updateTicker() {
            const ticker = document.getElementById('ticker');
            const line = newsLines[Math.floor(Math.random() * newsLines.length)];
            const newTicker = ticker.cloneNode(true);
            newTicker.textContent = line;
            ticker.parentNode.replaceChild(newTicker, ticker);
        }

        function trySpawnGoldenCat() {
            if (Math.random() > 0.6) { 
                const cat = document.createElement('div');
                cat.textContent = 'üò∏'; cat.className = 'golden-cat';
                cat.style.left = Math.random() * (window.innerWidth - 100) + 'px';
                cat.style.top = Math.random() * (window.innerHeight - 100) + 'px';
                cat.onclick = () => {
                    playSound('golden');
                    const bonus = globalCPS * 300 + 1000;
                    game.score += bonus;
                    spawnToast('Gato Dourado!', `+${formatNumber(bonus)} Ronrons!`);
                    cat.remove();
                };
                document.body.appendChild(cat);
                setTimeout(() => { if(cat.parentNode) cat.remove(); }, 8000);
            }
        }

        function checkAchievements() {
            game.achievements.forEach(ach => {
                if (ach.unlocked) return;
                let condition = false;
                if (ach.type === 'score' && game.totalScore >= ach.req) condition = true;
                if (ach.type === 'building' && game.buildings.reduce((a,b)=>a+b.count,0) >= ach.req) condition = true;
                if (ach.type === 'prestige' && game.prestigeCount >= ach.req) condition = true;

                if (condition) {
                    ach.unlocked = true;
                    spawnToast('Conquista!', ach.name);
                    playSound('golden');
                    // Verificar se desbloqueou skin
                    game.skins.forEach(skin => {
                        if (skin.type === 'ach' && skin.reqId === ach.id) {
                            spawnToast('Nova Skin!', `Voc√™ desbloqueou: ${skin.name}`);
                            skin.unlocked = true;
                        }
                    });
                }
            });
        }

        function checkOfflineProgress() {
            const now = Date.now();
            const diff = (now - game.lastSave) / 1000;
            if (diff > 60 && globalCPS > 0) {
                const earned = diff * globalCPS;
                game.score += earned;
                game.totalScore += earned;
                document.getElementById('offline-gains').innerText = formatNumber(earned);
                toggleModal('modal-offline');
            }
        }

        // --- SAVE/LOAD ---
        function saveGame() {
            game.lastSave = Date.now();
            localStorage.setItem('mestreGatosSave_v3', JSON.stringify(game));
        }

        function loadGame() {
            const saved = JSON.parse(localStorage.getItem('mestreGatosSave_v3'));
            if (saved) {
                // Deep merge para garantir compatibilidade
                game = { ...defaultGame, ...saved };
                game.buildings.forEach((b, i) => { if(saved.buildings[i]) b.count = saved.buildings[i].count; });
                game.clickUpgrades.forEach((u, i) => { if(saved.clickUpgrades[i]) u.count = saved.clickUpgrades[i].count; });
                game.boosts.forEach((b, i) => { if(saved.boosts[i]) b.owned = saved.boosts[i].owned; });
                game.achievements.forEach((a, i) => { if(saved.achievements[i]) a.unlocked = saved.achievements[i].unlocked; });
                // Load Skins status
                if(saved.skins) {
                     game.skins.forEach((s, i) => { if(saved.skins[i]) s.unlocked = saved.skins[i].unlocked; });
                }
            }
        }

        init();
    </script>
</body>
</html>
