<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mestre dos Gatos: Ascens√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #121013;
            --bg-panel: rgba(40, 35, 40, 0.7);
            --accent: #ffcc00;
            --accent-glow: rgba(255, 204, 0, 0.5);
            --text-main: #ffffff;
            --text-dim: #a0a0a0;
            --green: #4cd964;
            --red: #ff453a;
            --purple: #bf5af2;
            --prestige: #00d2ff; /* Azul Ciano para Prest√≠gio */
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-user-select: none; }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(191, 90, 242, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 204, 0, 0.1) 0%, transparent 20%);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- ANIMA√á√ïES --- */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        @keyframes shine { 0% { background-position: -100px; } 100% { background-position: 300px; } }
        @keyframes goldenSpawn { 0% { transform: scale(0) rotate(180deg); opacity: 0; } 100% { transform: scale(1) rotate(0); opacity: 1; } }
        @keyframes fadeOutUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-50px); } }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- NEWS TICKER --- */
        .news-ticker {
            background: rgba(0,0,0,0.8);
            width: 100%;
            height: 30px;
            overflow: hidden;
            position: relative;
            z-index: 100;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
        }
        .ticker-content {
            white-space: nowrap;
            position: absolute;
            animation: tickerMove 20s linear infinite;
            font-size: 0.9rem;
            color: #ddd;
            font-style: italic;
        }
        @keyframes tickerMove { 0% { left: 100%; } 100% { left: -100%; } }

        /* --- UI GERAL --- */
        .game-layout {
            display: flex;
            flex: 1;
            height: calc(100% - 30px);
            position: relative;
        }

        /* ESQUERDA: O GATO */
        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 10;
        }

        .score-container {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .main-score {
            font-family: 'Fredoka One', cursive;
            font-size: 4rem;
            color: var(--accent);
            text-shadow: 0 0 20px var(--accent-glow);
            line-height: 1;
        }

        .cps-label { font-size: 1.1rem; color: var(--text-dim); margin-top: 5px; font-weight: 700; }
        
        /* Novelo de Ouro (Prest√≠gio) */
        .prestige-currency {
            color: var(--prestige);
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 5px;
            display: none; /* S√≥ aparece se tiver */
            text-shadow: 0 0 10px rgba(0, 210, 255, 0.4);
        }

        .cat-area {
            position: relative;
            cursor: pointer;
            transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            -webkit-tap-highlight-color: transparent;
        }

        .cat-emoji {
            font-size: 14rem;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
            transition: all 0.1s;
        }

        .cat-area:active .cat-emoji { transform: scale(0.95) rotate(-3deg); }
        .cat-area:hover .cat-emoji { filter: drop-shadow(0 0 40px var(--accent-glow)); }

        /* DIREITA: LOJA */
        .right-panel {
            width: 420px;
            background: var(--bg-panel);
            backdrop-filter: blur(10px);
            border-left: var(--glass-border);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: -10px 0 50px rgba(0,0,0,0.5);
            z-index: 20;
        }

        .store-header {
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-bottom: var(--glass-border);
        }

        .tab-container { display: flex; gap: 5px; margin-bottom: 10px; }
        
        .tab-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border: none;
            color: var(--text-dim);
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Nunito', sans-serif;
        }
        
        .tab-btn.active {
            background: var(--accent);
            color: #121013;
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .multiplier-controls { display: flex; justify-content: center; gap: 5px; font-size: 0.8rem; }
        .mult-btn {
            background: transparent; border: 1px solid #555; color: #777;
            padding: 2px 8px; border-radius: 4px; cursor: pointer;
        }
        .mult-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(255, 204, 0, 0.1); }

        .store-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        /* Custom Scrollbar */
        .store-list::-webkit-scrollbar { width: 6px; }
        .store-list::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }

        .store-item {
            background: rgba(255,255,255,0.03);
            border: var(--glass-border);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .store-item:hover { transform: translateX(-3px); background: rgba(255,255,255,0.07); }
        .store-item.disabled { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; }
        .store-item.purchased { background: rgba(76, 217, 100, 0.1); border-color: var(--green); }

        .item-icon { font-size: 2rem; margin-right: 15px; width: 40px; text-align: center; }
        .item-details { flex: 1; }
        .item-name { font-weight: 800; font-size: 1rem; color: #fff; }
        .item-cost { color: var(--red); font-weight: bold; font-size: 0.9rem; }
        .item-bonus { font-size: 0.75rem; color: var(--text-dim); }
        .item-count { font-size: 1.5rem; font-weight: 900; color: rgba(255,255,255,0.1); margin-left: 10px; }

        /* Gato Dourado */
        .golden-cat {
            position: absolute;
            font-size: 5rem;
            cursor: pointer;
            z-index: 999;
            filter: drop-shadow(0 0 20px gold);
            animation: goldenSpawn 0.5s ease-out;
        }

        /* Achievements Popups */
        .achievement-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .achievement-toast {
            background: rgba(30, 30, 30, 0.95);
            border-left: 4px solid var(--accent);
            padding: 15px;
            border-radius: 4px;
            color: #fff;
            width: 300px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            animation: slideInRight 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            display: flex;
            align-items: center;
        }
        .ach-icon { font-size: 2rem; margin-right: 15px; }

        /* Part√≠culas de Clique */
        .particle {
            position: absolute;
            pointer-events: none;
            font-weight: 900;
            font-size: 1.5rem;
            animation: fadeOutUp 1s forwards;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 100;
        }
        
        .particle.crit { color: var(--accent); font-size: 2.2rem; text-shadow: 0 0 10px var(--accent); }

        /* MODAIS */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .modal {
            background: #252025;
            padding: 2rem;
            border-radius: 15px;
            width: 90%; max-width: 500px;
            text-align: center;
            border: 1px solid #444;
            box-shadow: 0 0 50px rgba(0,0,0,0.7);
            transform: scale(0.8); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-overlay.active .modal { transform: scale(1); }

        .modal h2 { font-family: 'Fredoka One'; color: var(--accent); margin-bottom: 10px; font-size: 2rem; }
        .modal p { color: #ccc; margin-bottom: 20px; line-height: 1.6; }
        
        .btn {
            padding: 12px 25px; border: none; border-radius: 50px; font-weight: bold; font-size: 1rem;
            cursor: pointer; transition: 0.2s; font-family: 'Nunito';
            background: #444; color: #fff;
        }
        .btn:hover { transform: scale(1.05); filter: brightness(1.2); }
        .btn-primary { background: var(--accent); color: #121013; }
        .btn-danger { background: var(--red); color: white; }
        .btn-prestige { background: var(--prestige); color: #003344; box-shadow: 0 0 15px rgba(0, 210, 255, 0.4); }

        /* Bot√µes de controle inferiores */
        .bottom-controls {
            position: absolute; bottom: 20px;
            display: flex; gap: 10px;
        }
        .ctrl-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: #aaa; width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
        }
        .ctrl-btn:hover { background: #fff; color: #000; }

        @media (max-width: 800px) {
            .game-layout { flex-direction: column; overflow-y: auto; }
            .right-panel { width: 100%; height: auto; border-left: none; border-top: 1px solid #333; }
            .cat-emoji { font-size: 10rem; margin: 20px 0; }
            .bottom-controls { position: relative; bottom: auto; margin-bottom: 20px; }
            .main-score { font-size: 3rem; }
        }
    </style>
</head>
<body>

    <div class="news-ticker">
        <div class="ticker-content" id="ticker">Bem-vindo ao Mestre dos Gatos! Comece a fazer carinho!</div>
    </div>

    <div class="game-layout">
        <section class="left-panel">
            <div class="score-container">
                <div class="main-score" id="score">0</div>
                <div class="cps-label">Ronrons por segundo: <span id="cps">0.0</span></div>
                <div class="prestige-currency" id="prestige-display">üß∂ Novelos de Ouro: 0 (+0% b√¥nus)</div>
            </div>

            <div class="cat-area" id="cat-clicker">
                <div class="cat-emoji" id="cat-emoji">üê±</div>
            </div>

            <div class="bottom-controls">
                <button class="ctrl-btn" id="btn-stats" title="Estat√≠sticas">üìä</button>
                <button class="ctrl-btn" id="btn-settings" title="Op√ß√µes">‚öôÔ∏è</button>
                <button class="ctrl-btn" id="btn-prestige" title="Ascens√£o" style="color:var(--prestige); border-color:var(--prestige);">üåÄ</button>
            </div>
        </section>

        <section class="right-panel">
            <div class="store-header">
                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('buildings')">Estruturas</button>
                    <button class="tab-btn" onclick="switchTab('upgrades')">Upgrades</button>
                    <button class="tab-btn" onclick="switchTab('boosts')">Acess√≥rios</button>
                </div>
                <div class="multiplier-controls">
                    <span>Comprar:</span>
                    <button class="mult-btn active" onclick="setMultiplier(1)">1x</button>
                    <button class="mult-btn" onclick="setMultiplier(10)">10x</button>
                    <button class="mult-btn" onclick="setMultiplier(100)">100x</button>
                </div>
            </div>
            <div class="store-list" id="store-list">
                </div>
        </section>
    </div>

    <div class="achievement-container" id="achievement-container"></div>

    <div class="modal-overlay" id="modal-prestige">
        <div class="modal">
            <h2>Ascens√£o C√≥smica üåÄ</h2>
            <p>Seus gatos alcan√ßaram o nirvana. Ao resetar, voc√™ perde todos os gatos e estruturas, mas ganha <b>Novelos de Ouro</b>.</p>
            <p>Cada Novelo aumenta seu CPS em <b>+10%</b> permanentemente.</p>
            <div style="background:rgba(0,0,0,0.3); padding:15px; border-radius:8px; margin-bottom:20px;">
                <p style="margin:0; font-size:0.9rem; color:#aaa;">Recompensa ao resetar:</p>
                <h3 style="color:var(--prestige); font-size:2.5rem; margin:5px 0;" id="prestige-reward-amount">+0</h3>
                <p style="margin:0; font-size:0.8rem; color:#aaa;">Novelos de Ouro</p>
            </div>
            <div style="display:flex; gap:10px; justify-content:center;">
                <button class="btn btn-prestige" onclick="doPrestige()">Resetar e Ascender</button>
                <button class="btn" onclick="toggleModal('modal-prestige')">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-offline">
        <div class="modal">
            <h2>Bem-vindo de volta! üåô</h2>
            <p>Enquanto voc√™ dormia, seus gatos trabalharam.</p>
            <h3 style="color:var(--accent); font-size:2.5rem;" id="offline-gains">+0</h3>
            <p>Ronrons coletados</p>
            <button class="btn btn-primary" onclick="toggleModal('modal-offline')">Coletar</button>
        </div>
    </div>

    <script>
        // --- SISTEMA DE √ÅUDIO (SINTETIZADOR) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'click') {
                // "Pop" suave
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(300, now + 0.1);
                gainNode.gain.setValueAtTime(0.3, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'buy') {
                // "Cha-ching" agudo
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(1200, now);
                osc.frequency.linearRampToValueAtTime(1800, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            } else if (type === 'golden') {
                // Som m√°gico
                osc.type = 'sine';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.linearRampToValueAtTime(2000, now + 0.5);
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            }
        }

        // --- DADOS DO JOGO ---
        let game = {
            score: 0,
            totalScore: 0, // Lifetime accumulated
            startTime: Date.now(),
            lastSave: Date.now(),
            prestigeCurrency: 0, // Novelos de Ouro
            buildings: [
                { id: 'b0', name: 'M√£o Humana', baseCost: 15, cps: 0.1, count: 0, icon: 'üëÜ' },
                { id: 'b1', name: 'Caixa de Papel√£o', baseCost: 100, cps: 1, count: 0, icon: 'üì¶' },
                { id: 'b2', name: 'Arranhador', baseCost: 1100, cps: 8, count: 0, icon: 'üß∂' },
                { id: 'b3', name: 'Jardim de Catnip', baseCost: 12000, cps: 47, count: 0, icon: 'üåø' },
                { id: 'b4', name: 'F√°brica de Sach√™', baseCost: 130000, cps: 260, count: 0, icon: 'üè≠' },
                { id: 'b5', name: 'Ex√©rcito Felino', baseCost: 1400000, cps: 1400, count: 0, icon: 'üòº' },
                { id: 'b6', name: 'Templo Bastet', baseCost: 20000000, cps: 7800, count: 0, icon: 'üèõÔ∏è' },
                { id: 'b7', name: 'Planeta Miau', baseCost: 330000000, cps: 44000, count: 0, icon: 'ü™ê' },
                { id: 'b8', name: 'Dimens√£o Gat√°stica', baseCost: 5100000000, cps: 260000, count: 0, icon: 'üåå' }
            ],
            clickUpgrades: [
                { id: 'u0', name: 'Cortar Unhas', cost: 500, power: 1, count: 0, icon: 'üíÖ' },
                { id: 'u1', name: 'Luva de Escovar', cost: 5000, power: 5, count: 0, icon: 'üß§' },
                { id: 'u2', name: 'Laser Pointer', cost: 50000, power: 25, count: 0, icon: 'üî¶' },
                { id: 'u3', name: 'Varinha M√°gica', cost: 1000000, power: 100, count: 0, icon: 'ü™Ñ' }
            ],
            boosts: [
                { id: 'bst0', name: 'Leite Premium', cost: 5000, target: 'b0', mult: 2, owned: false, icon: 'ü•õ' },
                { id: 'bst1', name: 'Caixa Dupla', cost: 25000, target: 'b1', mult: 2, owned: false, icon: 'üì¶' },
                { id: 'bst2', name: 'Catnip OGM', cost: 100000, target: 'b3', mult: 2, owned: false, icon: 'üß™' },
                { id: 'bst3', name: 'Automa√ß√£o', cost: 5000000, target: 'b4', mult: 2, owned: false, icon: '‚öôÔ∏è' }
            ],
            achievements: [
                { id: 'ach0', name: 'Iniciante', req: 100, type: 'score', unlocked: false, desc: 'Colete 100 ronrons' },
                { id: 'ach1', name: 'Louco dos Gatos', req: 50, type: 'building', unlocked: false, desc: 'Tenha 50 estruturas totais' },
                { id: 'ach2', name: 'Milion√°rio', req: 1000000, type: 'score', unlocked: false, desc: 'Colete 1 milh√£o de ronrons' }
            ]
        };

        // Estado da UI
        let currentTab = 'buildings';
        let buyMultiplier = 1;
        let globalCPS = 0;
        let clickPower = 1;

        // --- NOTICI√ÅRIO ---
        const newsLines = [
            "Cientistas confirmam: O universo √© feito de pelos de gato.",
            "Gato derruba copo da borda da Terra Plana.",
            "Mercado de sach√™ sobe 500% ap√≥s investimento felino.",
            "Cachorros pedem tr√©gua, mas s√£o ignorados.",
            "Novo imperador do mundo exige caixas de papel√£o maiores.",
            "Ronronar √© declarado a nova fonte de energia renov√°vel."
        ];
        function updateTicker() {
            const ticker = document.getElementById('ticker');
            const line = newsLines[Math.floor(Math.random() * newsLines.length)];
            // Reset animation trick
            const newTicker = ticker.cloneNode(true);
            newTicker.textContent = line;
            ticker.parentNode.replaceChild(newTicker, ticker);
        }
        setInterval(updateTicker, 10000);

        // --- CORE LOGIC ---

        function init() {
            loadGame();
            recalcStats();
            renderStore();
            setInterval(gameLoop, 100); // 10 ticks por segundo
            setInterval(saveGame, 30000); // Autosave 30s
            setInterval(trySpawnGoldenCat, 60000); // Tenta spawnar gato dourado a cada 1m
            
            // Verifica offline
            const now = Date.now();
            const diff = (now - game.lastSave) / 1000;
            if (diff > 60 && globalCPS > 0) {
                const earned = diff * globalCPS;
                game.score += earned;
                game.totalScore += earned;
                document.getElementById('offline-gains').innerText = formatNumber(earned);
                toggleModal('modal-offline');
            }
        }

        function gameLoop() {
            // Ganho passivo
            const gain = globalCPS / 10;
            if (gain > 0) {
                game.score += gain;
                game.totalScore += gain;
            }
            updateUI();
            checkAchievements();
        }

        function clickCat(e) {
            playSound('click');
            
            // Crit chance (1% base)
            let isCrit = Math.random() < 0.01;
            let amount = clickPower * (isCrit ? 5 : 1);
            
            game.score += amount;
            game.totalScore += amount;

            // Visual Effect
            createParticle(e.clientX, e.clientY, `+${formatNumber(amount)}`, isCrit);
            
            const cat = document.getElementById('cat-emoji');
            cat.style.transform = 'scale(0.9)';
            setTimeout(() => cat.style.transform = 'scale(1)', 50);
        }

        document.getElementById('cat-clicker').addEventListener('pointerdown', clickCat);

        // --- CALCULA√á√ïES ---

        function recalcStats() {
            // Base CPS
            let cps = 0;
            game.buildings.forEach(b => {
                let multiplier = 1;
                // Aplica boosts
                game.boosts.forEach(bst => {
                    if (bst.owned && bst.target === b.id) multiplier *= bst.mult;
                });
                cps += b.count * b.cps * multiplier;
            });

            // Base Click Power
            let cPower = 1;
            game.clickUpgrades.forEach(u => {
                cPower += u.count * u.power;
            });

            // Prest√≠gio Multiplier (10% por novelo)
            const prestigeMult = 1 + (game.prestigeCurrency * 0.10);
            
            globalCPS = cps * prestigeMult;
            clickPower = cPower * prestigeMult;

            // Atualiza UI de prest√≠gio
            const pDisplay = document.getElementById('prestige-display');
            if (game.prestigeCurrency > 0) {
                pDisplay.style.display = 'block';
                pDisplay.innerText = `üß∂ Novelos de Ouro: ${formatNumber(game.prestigeCurrency)} (+${formatNumber(game.prestigeCurrency * 10)}% b√¥nus)`;
            }
        }

        // --- STORE LOGIC ---

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderStore();
        }

        function setMultiplier(m) {
            buyMultiplier = m;
            document.querySelectorAll('.mult-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderStore();
        }

        function getBuildingCost(b, count) {
            let total = 0;
            let currentCost = b.baseCost * Math.pow(1.15, b.count);
            for(let i=0; i<count; i++) {
                total += currentCost;
                currentCost *= 1.15;
            }
            return Math.floor(total);
        }

        function renderStore() {
            const list = document.getElementById('store-list');
            list.innerHTML = '';

            let items = [];
            if (currentTab === 'buildings') items = game.buildings;
            else if (currentTab === 'upgrades') items = game.clickUpgrades;
            else if (currentTab === 'boosts') items = game.boosts;

            items.forEach((item, index) => {
                const el = document.createElement('div');
                
                let cost, name, desc, owned;
                let canBuy = false;

                if (currentTab === 'buildings') {
                    cost = getBuildingCost(item, buyMultiplier);
                    name = item.name;
                    desc = `+${formatNumber(item.cps * buyMultiplier)} CPS`;
                    owned = item.count;
                    canBuy = game.score >= cost;
                } else if (currentTab === 'upgrades') {
                    // Custo fixo escalonado simples para exemplo
                    cost = Math.floor(item.cost * Math.pow(1.5, item.count)); 
                    name = item.name;
                    desc = `+${item.power} Clique`;
                    owned = item.count;
                    canBuy = game.score >= cost;
                } else {
                    cost = item.cost;
                    name = item.name;
                    desc = `x${item.mult} para ${getBuildingName(item.target)}`;
                    owned = item.owned ? "OK" : "";
                    canBuy = !item.owned && game.score >= cost;
                }

                // N√£o renderiza boosts j√° comprados para limpar a lista
                if (currentTab === 'boosts' && item.owned) return;

                el.className = `store-item ${canBuy ? '' : 'disabled'}`;
                el.onclick = () => buyItem(currentTab, index);
                
                el.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-details">
                        <div class="item-name">${name}</div>
                        <div class="item-cost">${formatNumber(cost)} üß∂</div>
                        <div class="item-bonus">${desc}</div>
                    </div>
                    <div class="item-count">${owned}</div>
                `;
                list.appendChild(el);
            });
        }

        function getBuildingName(id) {
            const b = game.buildings.find(x => x.id === id);
            return b ? b.name : '???';
        }

        function buyItem(type, index) {
            playSound('buy');
            if (type === 'buildings') {
                const b = game.buildings[index];
                const cost = getBuildingCost(b, buyMultiplier);
                if (game.score >= cost) {
                    game.score -= cost;
                    b.count += buyMultiplier;
                    recalcStats();
                    renderStore();
                }
            } else if (type === 'upgrades') {
                const u = game.clickUpgrades[index];
                const cost = Math.floor(u.cost * Math.pow(1.5, u.count));
                if (game.score >= cost) {
                    game.score -= cost;
                    u.count++;
                    recalcStats();
                    renderStore();
                }
            } else if (type === 'boosts') {
                const bst = game.boosts[index];
                if (!bst.owned && game.score >= bst.cost) {
                    game.score -= bst.cost;
                    bst.owned = true;
                    recalcStats();
                    renderStore();
                    spawnToast('Upgrade!', `Voc√™ comprou ${bst.name}`);
                }
            }
        }

        // --- PRESTIGE SYSTEM ---
        document.getElementById('btn-prestige').onclick = () => {
            // F√≥rmula: Raiz c√∫bica do total score / 1 milh√£o
            const potential = Math.floor(Math.cbrt(game.totalScore / 1000000));
            
            // S√≥ vale a pena se ganhar algo
            if (potential <= game.prestigeCurrency) {
                document.getElementById('prestige-reward-amount').innerText = "0";
                // Ainda abre o modal para mostrar info
            } else {
                document.getElementById('prestige-reward-amount').innerText = `+${formatNumber(potential - game.prestigeCurrency)}`;
            }
            toggleModal('modal-prestige');
        };

        function doPrestige() {
            const potential = Math.floor(Math.cbrt(game.totalScore / 1000000));
            if (potential > game.prestigeCurrency) {
                // Hard Reset na economia, mant√©m stats de conquista/prestigio
                const earned = potential - game.prestigeCurrency;
                game.prestigeCurrency += earned;
                
                // Reset Buildings/Upgrades/Money
                game.score = 0;
                game.buildings.forEach(b => b.count = 0);
                game.clickUpgrades.forEach(u => u.count = 0);
                game.boosts.forEach(b => b.owned = false);
                
                game.startTime = Date.now();
                
                recalcStats();
                renderStore();
                toggleModal('modal-prestige');
                spawnToast('Ascens√£o!', `Voc√™ renasceu com ${game.prestigeCurrency} Novelos de Ouro.`);
            }
        }

        // --- EVENTS ---

        function trySpawnGoldenCat() {
            // 30% chance a cada minuto
            if (Math.random() > 0.7) { 
                const cat = document.createElement('div');
                cat.textContent = 'üò∏';
                cat.className = 'golden-cat';
                
                // Posi√ß√£o aleat√≥ria na tela
                const x = Math.random() * (window.innerWidth - 100);
                const y = Math.random() * (window.innerHeight - 100);
                
                cat.style.left = x + 'px';
                cat.style.top = y + 'px';
                
                cat.onclick = () => {
                    playSound('golden');
                    const bonus = globalCPS * 300; // 5 minutos de produ√ß√£o
                    game.score += bonus;
                    spawnToast('Gato Dourado!', `+${formatNumber(bonus)} Ronrons!`);
                    createParticle(x, y, `+${formatNumber(bonus)}`, true);
                    cat.remove();
                };

                document.body.appendChild(cat);
                
                // Desaparece em 10s
                setTimeout(() => { if(cat.parentNode) cat.remove(); }, 10000);
            }
        }

        function checkAchievements() {
            game.achievements.forEach(ach => {
                if (ach.unlocked) return;
                
                let condition = false;
                if (ach.type === 'score' && game.totalScore >= ach.req) condition = true;
                if (ach.type === 'building') {
                    const totalB = game.buildings.reduce((a,b) => a + b.count, 0);
                    if (totalB >= ach.req) condition = true;
                }

                if (condition) {
                    ach.unlocked = true;
                    spawnToast('Conquista!', ach.name);
                    playSound('golden'); // Reusing golden sound
                }
            });
        }

        // --- UTILS ---

        function updateUI() {
            document.getElementById('score').innerText = formatNumber(Math.floor(game.score));
            document.getElementById('cps').innerText = formatNumber(globalCPS.toFixed(1));
            
            // T√≠tulo da aba
            document.title = `${formatNumber(Math.floor(game.score))} Ronrons - Mestre dos Gatos`;

            // Verifica bot√µes da loja para habilitar/desabilitar visualmente
            // (Otimiza√ß√£o: fazer isso menos frequentemente em jogos muito grandes)
            const storeItems = document.querySelectorAll('.store-item');
            if (storeItems.length > 0 && currentTab === 'buildings') {
                 // Simplifica√ß√£o: apenas atualiza se pode comprar ou n√£o
                 // Idealmente, renderStore s√≥ roda quando algo muda pra valer
            }
        }

        function createParticle(x, y, text, isCrit) {
            const el = document.createElement('div');
            el.className = `particle ${isCrit ? 'crit' : ''}`;
            el.innerText = text;
            el.style.left = (x - 20) + 'px';
            el.style.top = (y - 20) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function spawnToast(title, msg) {
            const container = document.getElementById('achievement-container');
            const el = document.createElement('div');
            el.className = 'achievement-toast';
            el.innerHTML = `
                <div class="ach-icon">üèÜ</div>
                <div>
                    <div style="font-weight:bold; color:var(--accent)">${title}</div>
                    <div style="font-size:0.9rem">${msg}</div>
                </div>
            `;
            container.appendChild(el);
            setTimeout(() => {
                el.style.animation = 'fadeOutUp 0.5s forwards';
                setTimeout(() => el.remove(), 500);
            }, 4000);
        }

        function toggleModal(id) {
            const el = document.getElementById(id);
            el.classList.toggle('active');
        }

        function formatNumber(num) {
            if (num < 1000) return Math.floor(num);
            const suffixes = ["", "k", "M", "B", "T", "Qa", "Qi"];
            const suffixNum = Math.floor(("" + Math.floor(num)).length / 3);
            let shortValue = parseFloat((suffixNum != 0 ? (num / Math.pow(1000, suffixNum)) : num).toPrecision(3));
            if (shortValue % 1 != 0) {
                shortValue = shortValue.toFixed(1);
            }
            return shortValue + suffixes[suffixNum];
        }

        // --- SAVE SYSTEM ---
        function saveGame() {
            game.lastSave = Date.now();
            localStorage.setItem('mestreGatosSave_v2', JSON.stringify(game));
        }

        function loadGame() {
            const saved = JSON.parse(localStorage.getItem('mestreGatosSave_v2'));
            if (saved) {
                // Merge seguro para evitar erros em updates futuros
                game = { ...game, ...saved };
                // Garante que arrays de objetos tenham merge correto se adicionarmos novos items
                if (saved.buildings) {
                    game.buildings.forEach((b, i) => {
                        if (saved.buildings[i]) b.count = saved.buildings[i].count;
                    });
                }
                if (saved.clickUpgrades) {
                    game.clickUpgrades.forEach((u, i) => {
                        if (saved.clickUpgrades[i]) u.count = saved.clickUpgrades[i].count;
                    });
                }
                if (saved.boosts) {
                    game.boosts.forEach((b, i) => {
                        if (saved.boosts[i]) b.owned = saved.boosts[i].owned;
                    });
                }
                if (saved.achievements) {
                    game.achievements.forEach((a, i) => {
                        if (saved.achievements[i]) a.unlocked = saved.achievements[i].unlocked;
                    });
                }
            }
        }

        // Start
        init();

    </script>
</body>
</html>
